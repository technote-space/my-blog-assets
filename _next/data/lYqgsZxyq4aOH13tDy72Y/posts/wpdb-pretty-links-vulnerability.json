{"pageProps":{"post":{"id":"wpxml-pretty-links-vulnerability","title":"Pretty Links の脆弱性情報","content":"<html><head></head><body><div class=\"toc-wrapper\"><input type=\"checkbox\" class=\"toc-checkbox\" id=\"toc-checkbox-t06bfk2kmh\" checked><label class=\"toc-title\" for=\"toc-checkbox-t06bfk2kmh\">目次</label><nav class=\"toc\"><ol class=\"toc-level toc-level-1\"><li class=\"toc-item toc-item-h2\"><a class=\"toc-link toc-link-h2\" href=\"#v218-以前の脆弱性を悪用された場合\">v2.1.8 以前の脆弱性を悪用された場合</a><ol class=\"toc-level toc-level-2\"><li class=\"toc-item toc-item-h3\"><a class=\"toc-link toc-link-h3\" href=\"#リダイレクト先の書き換え\">リダイレクト先の書き換え</a></li><li class=\"toc-item toc-item-h3\"><a class=\"toc-link toc-link-h3\" href=\"#管理画面からjavascriptの実行\">管理画面からJavaScriptの実行</a></li></ol></li><li class=\"toc-item toc-item-h2\"><a class=\"toc-link toc-link-h2\" href=\"#v219-でも注意が必要です\">v.2.1.9 でも注意が必要です</a><ol class=\"toc-level toc-level-2\"><li class=\"toc-item toc-item-h3\"><a class=\"toc-link toc-link-h3\" href=\"#ajax経由のcsrf\">Ajax経由のCSRF</a></li><li class=\"toc-item toc-item-h3\"><a class=\"toc-link toc-link-h3\" href=\"#xss-対策の不備\">XSS 対策の不備</a></li></ol></li><li class=\"toc-item toc-item-h2\"><a class=\"toc-link toc-link-h2\" href=\"#脆弱性を含むプラグインの特徴\">脆弱性を含むプラグインの特徴</a></li><li class=\"toc-item toc-item-h2\"><a class=\"toc-link toc-link-h2\" href=\"#補足\">補足</a></li></ol></nav></div><p><a href=\"https://ja.wordpress.org/plugins/pretty-link/\" target=\"_blank\" rel=\"noreferrer noopener\">Pretty Links</a> v2.1.8 には <strong>CSRF</strong> 及び <strong>XSS</strong> の脆弱性があります。</p>\n\n<p>4/25 に報告して <span data-ma_stripe=\"true\" class=\"marker-animation\">5/1 にひっそりと修正されました。</span>(v2.1.9)</p>\n\n<p>使用している人はすぐに更新してください。</p>\n\n<h2 id=\"v218-以前の脆弱性を悪用された場合\">v2.1.8 以前の脆弱性を悪用された場合<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#v218-以前の脆弱性を悪用された場合\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h2>\n\n<p>更新せずに使用すると自分のサイトだけではなく閲覧者に被害が出る可能性があります。</p>\n\n<p>WordPressのプラグインはGPLライセンスですから閲覧者の被害はプラグインの責任ではなく、<span data-ma_color=\"#f78da7\" class=\"marker-animation\">プラグインを使用したあなたの責任</span>です。</p>\n\n<h3 id=\"リダイレクト先の書き換え\">リダイレクト先の書き換え<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#リダイレクト先の書き換え\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h3>\n\n<p>CSRFの脆弱性を利用することで本プラグインのメイン機能である<span class=\"artb-1029\">短縮URLのリダイレクト先を書き換え</span>ることが可能です。</p>\n\n<p>詐欺サイトに書き換えられてしまった場合、閲覧者に被害が出る可能性があります。</p>\n\n<h3 id=\"管理画面からjavascriptの実行\">管理画面からJavaScriptの実行<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#管理画面からjavascriptの実行\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h3>\n\n<p>CSRFの脆弱性を利用することで様々な設定を書き換えることが可能で、さらにその設定値を表示する際にエスケープ処理がされていないためXSSが発生します。</p>\n\n<p>XSSを利用することで管理画面からのPOSTやクッキーの流出などの被害が発生する可能性があります。</p>\n\n<h2 id=\"v219-でも注意が必要です\">v.2.1.9 でも注意が必要です<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#v219-でも注意が必要です\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h2>\n\n<h3 id=\"ajax経由のcsrf\">Ajax経由のCSRF<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#ajax経由のcsrf\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h3>\n\n<p>見逃しがちなのでしょうがないですが、修正が不十分だったため脆弱性が残っています。</p>\n\n<p>このプラグインを安全に利用するためには</p>\n\n<ul><li>記事の投稿以外はログアウトする</li><li>不用意にリンクを踏まない</li><li>自分で修正してCSRF対策を行う</li></ul>\n\n<p>などの自衛措置をとる必要があります。</p>\n\n<h3 id=\"xss-対策の不備\">XSS 対策の不備<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#xss-対策の不備\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h3>\n\n<p>こちらも修正が不十分だったためXSSが発生します。</p>\n\n<p>このXSSを利用すること対応のあったCSRFを回避してリダイレクト先を書き換えることなどが可能です。</p>\n\n<ul><li>不用意に Pretty Links の設定画面を開かない</li><li>Pretty Links の設定画面を開く前にDBを直接確認しスクリプトが保存されていないことを確認する</li></ul>\n\n<p>などの自衛措置をとる必要があります。</p>\n\n<h2 id=\"脆弱性を含むプラグインの特徴\">脆弱性を含むプラグインの特徴<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#脆弱性を含むプラグインの特徴\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h2>\n\n<figure class=\"wp-block-embed-wordpress wp-block-embed is-type-wp-embed is-provider-technote\"><div class=\"wp-block-embed__wrapper\">\n<div class=\"blog-card\"><iframe src=\"https://blog-card-ten.vercel.app/card/https%3A%2F%2Ftechnote.space%2Fwordpress%2Fyuzo-related-posts-vulnerability?id=blog-card-nroej9benr&#x26;referrer=https%3A%2F%2Ftechnote.space%2Fposts%2Fwpxml-pretty-links-vulnerability%2F\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" data-id=\"blog-card-nroej9benr\"></iframe></div>\n</div></figure>\n\n<p>このプラグインも例に漏れずいくつも当てはまります。</p>\n\n<figure class=\"wp-block-image\"><a href=\"https://technote.space/uploads/2019/05/201905291303-1.png\"><img src=\"https://technote.space/uploads/2019/05/201905291303-1.png\" alt=\"\" class=\"wp-image-1797\"></a></figure>\n\n<ul><li>未使用の引数の放置</li><li>未使用の変数の放置 </li><li>brace ルールの不統一</li><li>引数の space ルールの不統一</li><li>メソッドの命名規則の不統一</li><li>CSRF対策の不備</li><li>XSS対策の不備</li></ul>\n\n<p>WordPressのプラグインはプログラミング初心者でも簡単に機能を追加することができますが、たいていの場合非機能要件は無視されます。</p>\n\n<p>プラグインを利用する際は使用する前に一度ソースコードレベルで確認するべきです。</p>\n\n<h2 id=\"補足\">補足<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#補足\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h2>\n\n<p>この脆弱性は自作のCSRF検出プラグインによって発見されました。</p>\n\n<div class=\"blog-card\"><iframe src=\"https://blog-card-ten.vercel.app/card/https%3A%2F%2Ftechnote.space%2Fcsrf-detector?id=blog-card-s7d6iei364&#x26;referrer=https%3A%2F%2Ftechnote.space%2Fposts%2Fwpxml-pretty-links-vulnerability%2F\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" data-id=\"blog-card-s7d6iei364\"></iframe></div>\n<!-- /wp:paragraph --></body></html>","excerpt":"Pretty Links v2.1.8 には CSRF 及び XSS の脆弱性があります。 4/25 に報告して 5/1 にひっそりと修正されました。(v2.1.9) 使用している人はすぐに更新してください。   V2.1.8 以前の脆弱性...","postType":"post","tags":[{"slug":"csrf","name":"CSRF"},{"slug":"pretty-links","name":"Pretty Links"},{"slug":"xss","name":"XSS"}],"thumbnail":"https://technote.space/uploads/2018/11/computer_virus_backdoor.png","dominantColor":"rgba(171,173,174,0.3686274509803922)","createdAt":"2019-05-29T04:13:50.000Z","updatedAt":null},"prev":null,"next":{"id":"markdown-2021-09-27-test-toc","title":"目次の動作テスト","excerpt":"目次の動作テスト 見出し２のテスト１  これは１つめの見出し２です。  見出し２のテスト２  これは２つめの見出し２です。  見出し３のテスト１  これは１つめの見出し３です。  見出し３のテスト２  これは２つめの見出し３です。  見出し...","postType":"post","tags":[{"slug":"test","name":"test"},{"slug":"テスト","name":"テスト"},{"slug":"toc","name":"toc"}],"thumbnail":"/images/pet_cat_oddeye_black.png","createdAt":"2021-09-26T15:00:00.000Z","updatedAt":"2021-11-06T15:00:00.000Z"},"headerPages":[],"footerPages":[]},"__N_SSG":true}