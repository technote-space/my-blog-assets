{"pageProps":{"post":{"id":"wpxml-theme-security-report","title":"WordPressのテーマのセキュリティに関する問題を報告し提案したパッチが適用されました","content":"<html><head></head><body><div class=\"toc-wrapper\"><input type=\"checkbox\" class=\"toc-checkbox\" id=\"toc-checkbox-c78bf745kq\" checked><label class=\"toc-title\" for=\"toc-checkbox-c78bf745kq\">目次</label><nav class=\"toc\"><ol class=\"toc-level toc-level-1\"><li class=\"toc-item toc-item-h2\"><a class=\"toc-link toc-link-h2\" href=\"#発見したセキュリティに関する２点の問題\">発見したセキュリティに関する２点の問題</a><ol class=\"toc-level toc-level-2\"><li class=\"toc-item toc-item-h3\"><a class=\"toc-link toc-link-h3\" href=\"#csrfクロスサイトリクエストフォージェリ\">CSRF（クロスサイトリクエストフォージェリ）</a><ol class=\"toc-level toc-level-3\"><li class=\"toc-item toc-item-h4\"><a class=\"toc-link toc-link-h4\" href=\"#wp_create_nonce\">wp_create_nonce</a></li><li class=\"toc-item toc-item-h4\"><a class=\"toc-link toc-link-h4\" href=\"#wp_verify_nonce\">wp_verify_nonce</a></li></ol></li><li class=\"toc-item toc-item-h3\"><a class=\"toc-link toc-link-h3\" href=\"#xssクロスサイトスクリプティング\">XSS（クロスサイトスクリプティング）</a></li></ol></li><li class=\"toc-item toc-item-h2\"><a class=\"toc-link toc-link-h2\" href=\"#脆弱性の評価\">脆弱性の評価</a></li><li class=\"toc-item toc-item-h2\"><a class=\"toc-link toc-link-h2\" href=\"#まとめ\">まとめ</a></li></ol></nav></div><h2 id=\"発見したセキュリティに関する２点の問題\">発見したセキュリティに関する２点の問題<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#発見したセキュリティに関する２点の問題\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h2>\n\n<h3 id=\"csrfクロスサイトリクエストフォージェリ\">CSRF（クロスサイトリクエストフォージェリ）<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#csrfクロスサイトリクエストフォージェリ\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h3>\n\n<p>CSRFは<span class=\"marker-animation\">送信されたデータの送信元の検証を正しく行わなかった場合</span>に発生します。</p>\n\n<p>例えば以下のような手順で発生します。</p>\n\n<ol><li>WordPressで記事を書いている人（Aさん）が自身のWordPressサイト（サイトA）にログインしている状態</li><li>攻撃者が罠サイトにサイトAに不正なデータを送信する仕組みを設置</li><li>攻撃者がサイトAのコメントなどに罠サイトへのリンクを貼り付け</li><li>Aさんが罠サイトへのリンクを踏む</li><li>サイトAに不正なデータが送信されサイトの内容が書き換えられるなどの攻撃が完了</li></ol>\n\n<p>通常は送信元が正しいかどうかを検証する仕組みを入れて、不正なデータが送信された場合に更新しないようにします。</p>\n\n<p>WordPressにはその仕組みが用意されており、プラグインやテーマ作成者は特にデータ更新を行う仕組みを入れる際には必ず使用する必要があります。</p>\n\n<h4 id=\"wp_create_nonce\">wp_create_nonce<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#wp_create_nonce\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h4>\n\n<p>「<strong><a rel=\"noreferrer noopener\" aria-label=\"wp_create_nonce (新しいタブで開く)\" href=\"https://wpdocs.osdn.jp/関数リファレンス/wp_create_nonce\" target=\"_blank\">wp_create_nonce</a></strong>」で生成されたnonceをデータの送信元に埋め込みます。<br>「<strong><a rel=\"noreferrer noopener\" aria-label=\" (新しいタブで開く)\" href=\"https://wpdocs.osdn.jp/関数リファレンス/wp_nonce_field\" target=\"_blank\">wp_nonce_field</a></strong>」を使用するとhiddenなinputを出力してくれます。</p>\n\n<h4 id=\"wp_verify_nonce\">wp_verify_nonce<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#wp_verify_nonce\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h4>\n\n<p>「<strong><a rel=\"noreferrer noopener\" aria-label=\"wp_verify_nonce (新しいタブで開く)\" href=\"https://wpdocs.osdn.jp/関数リファレンス/wp_verify_nonce\" target=\"_blank\">wp_verify_nonce</a></strong>」で送信されたnonceが送信元で生成されたものかどうかを検証します。<br>似たものとして「<strong><a rel=\"noreferrer noopener\" aria-label=\"check_admin_referer (新しいタブで開く)\" href=\"https://wpdocs.osdn.jp/関数リファレンス/check_admin_referer\" target=\"_blank\">check_admin_referer</a></strong>」「<strong><a rel=\"noreferrer noopener\" aria-label=\" (新しいタブで開く)\" href=\"https://wpdocs.osdn.jp/関数リファレンス/check_ajax_referer\" target=\"_blank\">check_ajax_referer</a></strong>」があります。</p>\n\n<h3 id=\"xssクロスサイトスクリプティング\">XSS（クロスサイトスクリプティング）<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#xssクロスサイトスクリプティング\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h3>\n\n<p>XSSは<span class=\"marker-animation\">送信されたデータを無害化せずに出力</span>すると発生します。</p>\n\n<p>今回は少し特殊な状況（CSRFとの組み合わせ）での発生を確認しました。</p>\n\n<p>セッションIDなどが流出します。</p>\n\n<p> プラグインやテーマ作成者は出力を行う全てのページで<a href=\"https://wpdocs.osdn.jp/データ検証\">データ検証</a>を正しく行い、出力を無害化する必要があります。</p>\n\n<h2 id=\"脆弱性の評価\">脆弱性の評価<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#脆弱性の評価\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h2>\n\n<div class=\"blog-card\"><iframe src=\"https://blog-card-ten.vercel.app/card/https%3A%2F%2Fjvndb.jvn.jp%2Fcvss%2Fja%2Fv3.html%23CVSS%3A3.0%2FAV%3AN%2FAC%3AL%2FPR%3AN%2FUI%3AR%2FS%3AC%2FC%3AL%2FI%3AL%2FA%3AL%2FE%3AF%2FRL%3AU?id=blog-card-iubgtj14ip&#x26;referrer=https%3A%2F%2Ftechnote.space%2Fposts%2Fwpxml-theme-security-report%2F\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" data-id=\"blog-card-iubgtj14ip\"></iframe></div>\n\n<ul><li>攻撃元区分：ネットワーク</li><li> 攻撃条件の複雑さ：低<ul><li>通常のCSRF攻撃が可能でした</li></ul></li><li> 攻撃に必要な特権レベル：不要<ul><li>攻撃者は特権を必要としませんでした</li></ul></li><li> 利用者の関与：要 <ul><li>管理者が罠サイト等にアクセスする必要がありました</li></ul></li><li> 影響の想定範囲：変更あり<ul><li>スクリプトの注入が可能でフロントで実行される可能性がありました</li></ul></li><li> 気密性への影響：低 <ul><li>XSSを利用していくつかのクッキーが盗まれる可能性がありました</li></ul></li><li> 完全性への影響：低 <ul><li>広告等が攻撃者のものに書き換えられる可能性がありました</li></ul></li><li> 可用性への影響：低<ul><li>大量にデータが挿入され可用性が低下する可能性がありました</li></ul></li></ul>\n\n<ul><li>攻撃される可能性：攻撃可能 <ul><li>罠ページを用意すれば容易に攻撃が可能な状態でした </li></ul></li><li>利用可能な対策のレベル：なし<ul><li>その時は適用可能なパッチ等は公開されていませんでした</li></ul></li><li>その他：未評価</li></ul>\n\n<div class=\"blog-card\"><iframe src=\"https://blog-card-ten.vercel.app/card/https%3A%2F%2Fwww.ipa.go.jp%2Fsecurity%2Fvuln%2FCVSSv3.html?id=blog-card-tgff878cor&#x26;referrer=https%3A%2F%2Ftechnote.space%2Fposts%2Fwpxml-theme-security-report%2F\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" data-id=\"blog-card-tgff878cor\"></iframe></div>\n\n<h2 id=\"まとめ\">まとめ<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#まとめ\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h2>\n\n<p>以前クラウドソーシングでお金をとって作成している人のプラグインで今回よりも非常に危険な脆弱性を見つけています。 <br><a href=\"/security/troublesome\" target=\"_blank\" rel=\"noreferrer noopener\">/security/troublesome</a> <br>プロを名乗っている人でさえ脆弱性を埋め込む可能性があるため 、少なくとも利用するテーマやプラグインは一度プログラムを確認し、作者が書き並べている機能だけでなく<span class=\"marker-animation\">セキュリティやパフォーマンスの観点からもチェックを行うべき</span>だと考えます。</p>\n<!-- /wp:paragraph --></body></html>","excerpt":"発見したセキュリティに関する２点の問題 CSRF（クロスサイトリクエストフォージェリ） CSRFは送信されたデータの送信元の検証を正しく行わなかった場合に発生します。  例えば以下のような手順で発生します。   1. WordPressで記...","postType":"post","tags":[{"slug":"csrf","name":"CSRF"},{"slug":"%e3%82%bb%e3%82%ad%e3%83%a5%e3%83%aa%e3%83%86%e3%82%a3","name":"セキュリティ"},{"slug":"%e8%84%86%e5%bc%b1%e6%80%a7","name":"脆弱性"}],"thumbnail":"https://technote.space/uploads/2018/07/WordPress-logotype-wmark.png","dominantColor":"rgba(50,55,60,0.18823529411764706)","createdAt":"2019-01-18T19:49:26.000Z","updatedAt":null},"prev":{"id":"wpxml-csrf-detector","title":"CSRF検出プラグインを作成しました","excerpt":"GITHUB 機能  SQLの実行 及び nonceのチェック を監視します。 nonceのチェック が行われる前に create insert update delete などの SQLコマンドが実行 されたときに   * ログに保存  ...","postType":"post","tags":[{"slug":"csrf","name":"CSRF"},{"slug":"%e3%82%bb%e3%82%ad%e3%83%a5%e3%83%aa%e3%83%86%e3%82%a3","name":"セキュリティ"},{"slug":"%e3%83%97%e3%83%a9%e3%82%b0%e3%82%a4%e3%83%b3","name":"プラグイン"}],"thumbnail":"https://technote.space/uploads/2019/01/csrf-detector.png","createdAt":"2019-01-28T15:48:55.000Z","updatedAt":null},"next":{"id":"wpxml-notes-github-free-private-repository","title":"GitHubが無料でプライベートリポジトリを使用可能に","excerpt":"GitHubを無料で利用しているユーザーもプライベートリポジトリを作成できるようになりました！ すでに公開しているリポジトリでもプライベートに変更することが可能です。   * 1. 設定に移動  * 2. Make privateを押下  ...","postType":"post","tags":[{"slug":"github","name":"GitHub"},{"slug":"private-repository","name":"private repository"},{"slug":"%e3%83%97%e3%83%a9%e3%82%a4%e3%83%99%e3%83%bc%e3%83%88%e3%83%aa%e3%83%9d%e3%82%b8%e3%83%88%e3%83%aa","name":"プライベートリポジトリ"}],"thumbnail":"https://technote.space/uploads/2019/01/GitHub_Logo.png","createdAt":"2019-01-08T01:32:03.000Z","updatedAt":null},"headerPages":[],"footerPages":[]},"__N_SSG":true}