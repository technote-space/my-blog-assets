{"pageProps":{"post":{"id":"wpxml-travis-ci-use-build-stages","title":"Travis CI でビルドステージを使用する","content":"<html><head></head><body><div class=\"toc-wrapper\"><input type=\"checkbox\" class=\"toc-checkbox\" id=\"toc-checkbox-68daph07sr\" checked><label class=\"toc-title\" for=\"toc-checkbox-68daph07sr\">目次</label><nav class=\"toc\"><ol class=\"toc-level toc-level-1\"><li class=\"toc-item toc-item-h2\"><a class=\"toc-link toc-link-h2\" href=\"#動作確認用のリポジトリ\">動作確認用のリポジトリ</a></li><li class=\"toc-item toc-item-h2\"><a class=\"toc-link toc-link-h2\" href=\"#基本的な使用方法\">基本的な使用方法</a><ol class=\"toc-level toc-level-2\"><li class=\"toc-item toc-item-h3\"><a class=\"toc-link toc-link-h3\" href=\"#ステージの順番定義\">ステージの順番定義</a></li><li class=\"toc-item toc-item-h3\"><a class=\"toc-link toc-link-h3\" href=\"#ステージごとに実行条件を与えたい場合\">ステージごとに実行条件を与えたい場合</a></li></ol></li><li class=\"toc-item toc-item-h2\"><a class=\"toc-link toc-link-h2\" href=\"#ジョブの定義\">ジョブの定義</a></li><li class=\"toc-item toc-item-h2\"><a class=\"toc-link toc-link-h2\" href=\"#結果\">結果</a></li></ol></nav></div><p>ビルドステージとは、ジョブをグループ化し、ステージ内のジョブが終わってから次のステージに進むようなビルドを行うための仕組みです。</p>\n\n<div class=\"blog-card\"><iframe src=\"https://blog-card-ten.vercel.app/card/https%3A%2F%2Fdocs.travis-ci.com%2Fuser%2Fbuild-stages%2F?id=blog-card-utq6dpj921&#x26;referrer=https%3A%2F%2Ftechnote.space%2Fposts%2Fwpxml-travis-ci-use-build-stages%2F\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" data-id=\"blog-card-utq6dpj921\"></iframe></div>\n\n<h2 id=\"動作確認用のリポジトリ\">動作確認用のリポジトリ<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#動作確認用のリポジトリ\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h2>\n\n<div class=\"blog-card\"><iframe src=\"https://blog-card-ten.vercel.app/card/https%3A%2F%2Fgithub.com%2Ftechnote-space%2Ftest-travis?id=blog-card-3nnf7h3u9p&#x26;referrer=https%3A%2F%2Ftechnote.space%2Fposts%2Fwpxml-travis-ci-use-build-stages%2F\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" data-id=\"blog-card-3nnf7h3u9p\"></iframe></div>\n\n<h2 id=\"基本的な使用方法\">基本的な使用方法<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#基本的な使用方法\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h2>\n\n<h3 id=\"ステージの順番定義\">ステージの順番定義<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#ステージの順番定義\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h3>\n\n<pre class=\"wp-block-code\" style=\"background: #2e3440\"><code style=\"color: undefined\">stages:\n  - check\n  - test\n  - deploy</code></pre>\n\n<p>stages に定義したものが上から順に実行されます。</p>\n\n<h3 id=\"ステージごとに実行条件を与えたい場合\">ステージごとに実行条件を与えたい場合<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#ステージごとに実行条件を与えたい場合\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h3>\n\n<pre class=\"wp-block-code\" style=\"background: #2e3440\"><code style=\"color: undefined\">stages:\n  - check\n  - name: test\n    if: branch = master and tag IS blank and type IN (pull_request, api)\n  - name: deploy\n    if: tag IS present</code></pre>\n\n<p><span class=\"double-underline\">if を使用して条件を設定することが可能</span>です。</p>\n\n<div class=\"blog-card\"><iframe src=\"https://blog-card-ten.vercel.app/card/https%3A%2F%2Fdocs.travis-ci.com%2Fuser%2Fbuild-stages%2F%23specifying-stage-order-and-conditions?id=blog-card-7pls8424jf&#x26;referrer=https%3A%2F%2Ftechnote.space%2Fposts%2Fwpxml-travis-ci-use-build-stages%2F\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" data-id=\"blog-card-7pls8424jf\"></iframe></div>\n\n<p>上の例では master へのプルリクの時にテストを行い、タグがプッシュされたときにデプロイを行います。</p>\n\n<h2 id=\"ジョブの定義\">ジョブの定義<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#ジョブの定義\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h2>\n\n<pre class=\"wp-block-code\" style=\"background: #2e3440\"><code style=\"color: undefined\">jobs:\n  include:\n    - stage: check\n      language: php\n      php: '7.2'\n      script: php/check.sh\n    - stage: check\n      language: node_js\n      node_js: '11'\n      dist: trusty\n      script: node_js/check.sh\n\n    - stage: test\n      language: php\n      php: '7.2'\n      script: php/test.sh\n    - stage: test\n      language: node_js\n      node_js: '11'\n      dist: trusty\n      script: node_js/test.sh\n\n    - stage: deploy\n      language: node_js\n      node_js: '11'\n      script: skip\n      before_script: bin/before_deploy.sh\n      deploy:\n        provider: release\n        skip_cleanup: true\n        name: ${TRAVIS_TAG}\n        api_key:\n          secure: .........\n        file: ${RELEASE_FILE}\n        overwrite: true\n        on:\n          tags: true\n    - stage: deploy\n      language: node_js\n      node_js: '11'\n      dist: trusty\n      script: skip\n      deploy:\n        provider: script\n        script: bash bin/release.sh\n        on:\n          tags: true</code></pre>\n\n<p>jobs.include にジョブを定義します。</p>\n\n<p>stage には前述の stages に設定したものを指定します。</p>\n\n<p>それぞれのジョブで<span class=\"double-underline\">異なる言語、環境変数などを利用することができる</span>ため、非常に自由度が高いです。</p>\n\n<p>deploy も通常のものと同じように記述することができます。</p>\n\n<div class=\"blog-card\"><iframe src=\"https://blog-card-ten.vercel.app/card/https%3A%2F%2Fdocs.travis-ci.com%2Fuser%2Fdeployment?id=blog-card-ioul1ektvm&#x26;referrer=https%3A%2F%2Ftechnote.space%2Fposts%2Fwpxml-travis-ci-use-build-stages%2F\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" data-id=\"blog-card-ioul1ektvm\"></iframe></div>\n\n<p>ステージ内のすべてのジョブが完了してから次のステージに進みます。</p>\n\n<p>例：構文チェックステージが完了してからテストステージに進む</p>\n\n<h2 id=\"結果\">結果<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#結果\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h2>\n\n<p>無料だと３つのジョブまで並行して実行されます。</p>\n\n<p>しかし下のスクショでは、Checkステージが終わっていないため１つ枠が空いているにもかかわらず次のTestステージのジョブは開始されません。</p>\n\n<figure class=\"wp-block-image\"><a href=\"https://technote.space/uploads/2019/06/201906242244-1.png\"><img src=\"https://technote.space/uploads/2019/06/201906242244-1-1024x541.png\" alt=\"\" class=\"wp-image-1979\"></a></figure>\n\n<p>Checkステージのジョブがすべて完了するとTestステージのジョブが実行されます。</p>\n\n<figure class=\"wp-block-image\"><a href=\"https://technote.space/uploads/2019/06/201906242245-1.png\"><img src=\"https://technote.space/uploads/2019/06/201906242245-1-1024x528.png\" alt=\"\" class=\"wp-image-1980\"></a></figure>\n<!-- /wp:image --></body></html>","excerpt":"ビルドステージとは、ジョブをグループ化し、ステージ内のジョブが終わってから次のステージに進むようなビルドを行うための仕組みです。 動作確認用のリポジトリ     基本的な使用方法   ステージの順番定義  stages に定義したものが上か...","postType":"post","tags":[{"slug":"travis-ci","name":"Travis CI"}],"thumbnail":"https://technote.space/uploads/2019/06/TravisCI-Full-Color.png","dominantColor":"rgba(137,121,101,0.3176470588235294)","createdAt":"2019-06-24T13:55:41.000Z","updatedAt":null},"prev":{"id":"wpxml-gutenberg-package-versions","title":"Gutenbergのパッケージのバージョン取得API","excerpt":"Gutenbergは下位互換性はあまり考慮されておらず、破壊的な変更が度々発生します。 また、それぞれの環境で使用されているGutenbergや使用されているパッケージのバージョンを取得する方法がありません。 下記の記事で書いてあるように一...","postType":"post","tags":[{"slug":"api","name":"api"},{"slug":"gutenberg","name":"Gutenberg"},{"slug":"travis-ci","name":"Travis CI"}],"thumbnail":"https://technote.space/uploads/2018/12/banner-772x250.jpg","createdAt":"2019-07-18T16:51:41.000Z","updatedAt":null},"next":{"id":"wpxml-travis-ci-behavior","title":"Travis CI の挙動まとめ","excerpt":"引っかかった点などのまとめ DEPLOY.PROVIDER = RELEASES で既にリリース済みに対してデプロイを行った場合 deploy.overwrite = true を設定しておくことで上書きしてくれます。  Travis CI...","postType":"post","tags":[{"slug":"travis-ci","name":"Travis CI"}],"thumbnail":"https://technote.space/uploads/2019/06/TravisCI-Full-Color.png","createdAt":"2019-06-23T17:22:57.000Z","updatedAt":null},"headerPages":[],"footerPages":[{"label":"About","url":"/pages/wpxml-about/"},{"label":"プライバシーポリシー","url":"/pages/wpxml-privacy-policy/"},{"label":"お問い合わせ","url":"/pages/wpxml-contact/"}]},"__N_SSG":true}