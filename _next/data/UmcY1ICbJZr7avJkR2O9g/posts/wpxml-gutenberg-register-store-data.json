{"pageProps":{"post":{"id":"wpxml-gutenberg-register-store-data","title":"GutenbergのregisterStoreで注意すべき点","content":"<html><head></head><body><div class=\"toc-wrapper\"><input type=\"checkbox\" class=\"toc-checkbox\" id=\"toc-checkbox-7oq4h6o8oh\" checked><label class=\"toc-title\" for=\"toc-checkbox-7oq4h6o8oh\">目次</label><nav class=\"toc\"><ol class=\"toc-level toc-level-1\"><li class=\"toc-item toc-item-h2\"><a class=\"toc-link toc-link-h2\" href=\"#例\">例　</a></li><li class=\"toc-item toc-item-h2\"><a class=\"toc-link toc-link-h2\" href=\"#解決方法\">解決方法</a><ol class=\"toc-level toc-level-2\"><li class=\"toc-item toc-item-h3\"><a class=\"toc-link toc-link-h3\" href=\"#修正\">修正</a></li></ol></li></ol></nav></div><p>より高度なGutenbergプラグインを作成する場合は registerStore を使用した状態管理が必須です。</p>\n\n<div class=\"blog-card\"><iframe src=\"https://blog-card-ten.vercel.app/card/https%3A%2F%2Fwordpress.org%2Fgutenberg%2Fhandbook%2Fdesigners-developers%2Fdevelopers%2Fpackages%2Fpackages-data%2F?id=blog-card-gk45r5ttab&#x26;referrer=https%3A%2F%2Ftechnote.space%2Fposts%2Fwpxml-gutenberg-register-store-data%2F\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" data-id=\"blog-card-gk45r5ttab\"></iframe></div>\n\n<p>実装方法によっては状態を変更してもすぐに画面に反映されないため注意が必要です。</p>\n\n<h2 id=\"例\">例　<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#例\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h2>\n\n<p>例えば flag の状態が false の時に ON、true の時に OFF と表示されるボタンを <em>PluginMoreMenuItem</em> に追加します。 </p>\n\n<figure class=\"wp-block-image\"><a href=\"https://technote.space/uploads/2019/04/04162335.png\"><img src=\"https://technote.space/uploads/2019/04/04162335.png\" alt=\"\" class=\"wp-image-1511\"></a></figure>\n\n<p><em>store/constant.js</em></p>\n\n<pre class=\"language-js\" style=\"background: #2e3440\"><code class=\"language-js\"><span style=\"color: #81A1C1\">const</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">PLUGIN_NAME</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">=</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #A3BE8C\">PLUGIN_TEST</span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #81A1C1\">export</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">const</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">STORE_NAME</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">=</span><span style=\"color: #D8DEE9FF\"> PLUGIN_NAME</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #81A1C1\">export</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">const</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">SET_FLAG</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">=</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #A3BE8C\">@@</span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">+</span><span style=\"color: #D8DEE9FF\"> PLUGIN_NAME </span><span style=\"color: #81A1C1\">+</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #A3BE8C\">/SET_FLAG</span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #81A1C1\">;</span></code></pre>\n\n<p><em>store/actions.js</em></p>\n\n<pre class=\"language-js\" style=\"background: #2e3440\"><code class=\"language-js\"><span style=\"color: #81A1C1\">import</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">SET_FLAG</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">}</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">from</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #A3BE8C\">./constant</span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #81A1C1\">;</span>\n\n<span style=\"color: #81A1C1\">export</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">function</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #88C0D0\">setFlag</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">flag</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">)</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">\t</span><span style=\"color: #81A1C1\">return</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">\t\t</span><span style=\"color: #88C0D0\">type</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> SET_FLAG</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">\t\t</span><span style=\"color: #D8DEE9\">flag</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">\t</span><span style=\"color: #ECEFF4\">}</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #ECEFF4\">}</span></code></pre>\n\n<p><em>store/reducers.js</em></p>\n\n<pre class=\"language-js\" style=\"background: #2e3440\"><code class=\"language-js\"><span style=\"color: #81A1C1\">import</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">SET_FLAG</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">}</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">from</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #A3BE8C\">./constant</span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #81A1C1\">;</span>\n\n<span style=\"color: #81A1C1\">export</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">default</span><span style=\"color: #D8DEE9FF\"> ( </span><span style=\"color: #D8DEE9\">state</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">=</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">\t</span><span style=\"color: #88C0D0\">flag</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">false</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #ECEFF4\">},</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">action</span><span style=\"color: #D8DEE9FF\"> ) </span><span style=\"color: #81A1C1\">=></span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">\t</span><span style=\"color: #81A1C1\">switch</span><span style=\"color: #D8DEE9FF\"> ( </span><span style=\"color: #D8DEE9\">action</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #D8DEE9FF\">type ) </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">\t\t</span><span style=\"color: #81A1C1\">case</span><span style=\"color: #D8DEE9FF\"> SET_FLAG</span><span style=\"color: #ECEFF4\">:</span>\n<span style=\"color: #D8DEE9FF\">\t\t\t</span><span style=\"color: #D8DEE9\">state</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #D8DEE9\">flag</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">=</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">action</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #D8DEE9\">flag</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #D8DEE9FF\">\t\t\t</span><span style=\"color: #81A1C1\">return</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">state</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #D8DEE9FF\">\t</span><span style=\"color: #ECEFF4\">}</span>\n<span style=\"color: #D8DEE9FF\">\t</span><span style=\"color: #81A1C1\">return</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">state</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #ECEFF4\">}</span></code></pre>\n\n<p><em>store/selectors.js</em></p>\n\n<pre class=\"language-js\" style=\"background: #2e3440\"><code class=\"language-js\"><span style=\"color: #81A1C1\">export</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">function</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #88C0D0\">getFlag</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">state</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">)</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">\t</span><span style=\"color: #81A1C1\">return</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">state</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #D8DEE9\">flag</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #ECEFF4\">}</span></code></pre>\n\n<p><em>component/more-menu.js</em></p>\n\n<pre class=\"language-js\" style=\"background: #2e3440\"><code class=\"language-js\"><span style=\"color: #81A1C1\">const</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">Fragment</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">}</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">=</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">wp</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #D8DEE9\">element</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #81A1C1\">const</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">PluginMoreMenuItem</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">}</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">=</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">wp</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #D8DEE9\">editPost</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #81A1C1\">const</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">withSelect</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">withDispatch</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">}</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">=</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">wp</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #D8DEE9FF\">data</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #81A1C1\">const</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">compose</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">}</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">=</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">wp</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #D8DEE9\">compose</span><span style=\"color: #81A1C1\">;</span>\n\n<span style=\"color: #81A1C1\">import</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">STORE_NAME</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">}</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">from</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #A3BE8C\">../store/constant</span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #81A1C1\">;</span>\n\n<span style=\"color: #81A1C1\">export</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">function</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #88C0D0\">MoreMenu</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">flag</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">toggleFlag</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">}</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">)</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">\t</span><span style=\"color: #81A1C1\">return</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">&#x3C;Fragment></span>\n<span style=\"color: #D8DEE9FF\">\t\t</span><span style=\"color: #81A1C1\">&#x3C;PluginMoreMenuItem</span>\n<span style=\"color: #D8DEE9FF\">\t\t\t</span><span style=\"color: #8FBCBB\">onClick</span><span style=\"color: #81A1C1\">={</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">toggleFlag</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">}</span>\n<span style=\"color: #D8DEE9FF\">\t\t</span><span style=\"color: #81A1C1\">></span>\n<span style=\"color: #D8DEE9FF\">\t\t\t</span><span style=\"color: #81A1C1\">{</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">flag</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">?</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #A3BE8C\">OFF</span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #A3BE8C\">ON</span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">}</span>\n<span style=\"color: #D8DEE9FF\">\t\t</span><span style=\"color: #81A1C1\">&#x3C;/PluginMoreMenuItem></span>\n<span style=\"color: #D8DEE9FF\">\t</span><span style=\"color: #81A1C1\">&#x3C;/Fragment>;</span>\n<span style=\"color: #ECEFF4\">}</span>\n\n<span style=\"color: #81A1C1\">export</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">default</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #88C0D0\">compose</span><span style=\"color: #D8DEE9FF\">(</span>\n<span style=\"color: #D8DEE9FF\">\t</span><span style=\"color: #88C0D0\">withSelect</span><span style=\"color: #D8DEE9FF\">( </span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">select</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">)</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">=></span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">\t\t</span><span style=\"color: #81A1C1\">return</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">\t\t\t</span><span style=\"color: #88C0D0\">flag</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #88C0D0\">select</span><span style=\"color: #D8DEE9FF\">( STORE_NAME )</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #88C0D0\">getFlag</span><span style=\"color: #D8DEE9FF\">()</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">\t\t</span><span style=\"color: #ECEFF4\">}</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #D8DEE9FF\">\t</span><span style=\"color: #ECEFF4\">}</span><span style=\"color: #D8DEE9FF\"> )</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">\t</span><span style=\"color: #88C0D0\">withDispatch</span><span style=\"color: #D8DEE9FF\">( </span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">dispatch</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">flag</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">}</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">)</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">=></span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">\t\t</span><span style=\"color: #81A1C1\">return</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">\t\t\t</span><span style=\"color: #88C0D0\">toggleFlag</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">()</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">=></span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #88C0D0\">dispatch</span><span style=\"color: #D8DEE9FF\">( STORE_NAME )</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #88C0D0\">setFlag</span><span style=\"color: #D8DEE9FF\">( </span><span style=\"color: #81A1C1\">!</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">flag</span><span style=\"color: #D8DEE9FF\"> )</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">\t\t</span><span style=\"color: #ECEFF4\">}</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #D8DEE9FF\">\t</span><span style=\"color: #ECEFF4\">}</span><span style=\"color: #D8DEE9FF\"> )</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">)( </span><span style=\"color: #D8DEE9\">MoreMenu</span><span style=\"color: #D8DEE9FF\"> )</span><span style=\"color: #81A1C1\">;</span></code></pre>\n\n<p><em>store/index.js</em></p>\n\n<pre class=\"language-js\" style=\"background: #2e3440\"><code class=\"language-js\"><span style=\"color: #81A1C1\">const</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">registerStore</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">}</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">=</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">wp</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #D8DEE9FF\">data</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #81A1C1\">import</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">reducer</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">from</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #A3BE8C\">./reducer</span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #81A1C1\">import</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">*</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">as</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">selectors</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">from</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #A3BE8C\">./selectors</span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #81A1C1\">import</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">*</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">as</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">actions</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">from</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #A3BE8C\">./actions</span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #81A1C1\">import</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">STORE_NAME</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">}</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">from</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #A3BE8C\">./constant</span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #81A1C1\">;</span>\n\n<span style=\"color: #88C0D0\">registerStore</span><span style=\"color: #D8DEE9FF\">( STORE_NAME</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">reducer</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">selectors</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">actions</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">}</span><span style=\"color: #D8DEE9FF\"> )</span><span style=\"color: #81A1C1\">;</span></code></pre>\n\n<p><em>index.js</em></p>\n\n<pre class=\"language-js\" style=\"background: #2e3440\"><code class=\"language-js\"><span style=\"color: #81A1C1\">const</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">registerPlugin</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">=</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">wp</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #D8DEE9FF\">plugins</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #D8DEE9\">registerPlugin</span><span style=\"color: #81A1C1\">;</span>\n\n<span style=\"color: #81A1C1\">import</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #A3BE8C\">./store</span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #81A1C1\">import</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">MoreMenu</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">from</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #A3BE8C\">./components/more-menu</span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #81A1C1\">;</span>\n\n<span style=\"color: #88C0D0\">registerPlugin</span><span style=\"color: #D8DEE9FF\">( </span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #A3BE8C\">my-test-plugin</span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">\t</span><span style=\"color: #88C0D0\">render</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">()</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">=></span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">&#x3C;MoreMenu/></span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #ECEFF4\">}</span><span style=\"color: #D8DEE9FF\"> )</span><span style=\"color: #81A1C1\">;</span></code></pre>\n\n<p>上のような実装の場合、内部の状態 flag が更新されても flag によるボタンのラベル ON、OFF の切り替えはすぐには反映されません。</p>\n\n<p>右上の歯車マークを押してメニューを一度消したり、サイドバーのパネルを切り替えたりしてからもう一度確認したりすると反映されます。</p>\n\n<figure class=\"wp-block-image\"><a href=\"https://technote.space/uploads/2019/04/0410170007.gif\"><img src=\"https://technote.space/uploads/2019/04/0410170007.gif\" alt=\"\" class=\"wp-image-1513\"></a></figure>\n\n<h2 id=\"解決方法\">解決方法<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#解決方法\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h2>\n\n<p>Store を使用したアプリをすでに多く作ってきた人は上のプログラムの欠陥にすぐ気づくと思いますが、reducer に修正すべき箇所があります。</p>\n\n<p>具体的には引数の state の flag を変更して返却している箇所です。</p>\n\n<p>JavaScript における object の比較は<span data-ma_stripe=\"true\" data-ma_color=\"#f78da7\" class=\"double-underline\">参照の比較</span>になるので、引数の state と返り値は同じ値という判定になり、変化がないと判断されてしまいます。</p>\n\n<p>これを解決することで正しい動作になります。</p>\n\n<h3 id=\"修正\">修正<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#修正\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h3>\n\n<p><em>store/reducers.js</em></p>\n\n<pre class=\"wp-block-code\" style=\"background: #2e3440\"><code style=\"color: undefined\">import { SET_FLAG } from './constant';\n\nexport default ( state = {\n\tflag: false,\n}, action ) => {\n\tswitch ( action.type ) {\n\t\tcase SET_FLAG:\n\t\t\tconst newState = Object.assign( {}, state );\n\t\t\tnewState.flag = action.flag;\n\t\t\treturn newState;\n\t}\n\treturn state;\n}</code></pre>\n\n<p>参照が同じにならないように新しく object を作成して、それを返却するようにします。</p>\n\n<figure class=\"wp-block-image\"><a href=\"https://technote.space/uploads/2019/04/0410170003.gif\"><img src=\"https://technote.space/uploads/2019/04/0410170003.gif\" alt=\"\" class=\"wp-image-1512\"></a></figure>\n\n<p>すぐに反映されるようになりました。</p>\n<!-- /wp:paragraph --></body></html>","excerpt":"より高度なGutenbergプラグインを作成する場合は registerStore を使用した状態管理が必須です。 実装方法によっては状態を変更してもすぐに画面に反映されないため注意が必要です。   例　  例えば flag の状態が fa...","postType":"post","tags":[{"slug":"gutenberg","name":"Gutenberg"},{"slug":"registerstore","name":"registerStore"}],"thumbnail":"https://technote.space/uploads/2018/12/banner-772x250.jpg","dominantColor":"rgba(111,111,111,1)","createdAt":"2019-05-22T05:04:34.000Z","updatedAt":null},"prev":{"id":"wpxml-gutenberg-persist-local-data","title":"Gutenbergプラグイン用のデータを永続化する","excerpt":"Gutenbergには store による状態管理を簡単に行う方法が用意されています。 さらにその状態をブラウザのローカルストレージに保持するための仕組みもあります。 設定を保存することで、より便利なプラグインを作成することが可能です。  ...","postType":"post","tags":[{"slug":"gutenberg","name":"Gutenberg"},{"slug":"registerstore","name":"registerStore"}],"thumbnail":"https://technote.space/uploads/2018/12/banner-772x250.jpg","createdAt":"2019-05-23T12:48:12.000Z","updatedAt":null},"next":{"id":"wpxml-hide-blocks-temporarily","title":"Gutenbergのブロックを一時的に隠すプラグインを作成しました","excerpt":"機能 一時的にブロックを非表示にできます。  スタイルを戻すことで表示状態に戻ります。   導入手順   1. 最新版をGitHubからダウンロード     release.zip  2. 「プラグインのアップロード」からインストール   ...","postType":"post","tags":[{"slug":"gutenberg","name":"Gutenberg"}],"thumbnail":"https://technote.space/uploads/2019/04/banner-772x250-1.png","createdAt":"2019-04-28T12:59:39.000Z","updatedAt":null},"headerPages":[],"footerPages":[{"label":"About","url":"/pages/wpxml-about/"},{"label":"プライバシーポリシー","url":"/pages/wpxml-privacy-policy/"},{"label":"お問い合わせ","url":"/pages/wpxml-contact/"}]},"__N_SSG":true}