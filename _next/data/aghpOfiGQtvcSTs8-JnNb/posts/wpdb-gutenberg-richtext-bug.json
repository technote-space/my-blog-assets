{"pageProps":{"post":{"id":"wpxml-gutenberg-richtext-bug","title":"Gutenbergのリッチテキストの既知の問題","content":"<html><head></head><body><div class=\"toc-wrapper\"><input type=\"checkbox\" class=\"toc-checkbox\" id=\"toc-checkbox-bbacs78sl5\" checked><label class=\"toc-title\" for=\"toc-checkbox-bbacs78sl5\">目次</label><nav class=\"toc\"><ol class=\"toc-level toc-level-1\"><li class=\"toc-item toc-item-h2\"><a class=\"toc-link toc-link-h2\" href=\"#経緯\">経緯</a></li><li class=\"toc-item toc-item-h2\"><a class=\"toc-link toc-link-h2\" href=\"#現象\">現象</a></li><li class=\"toc-item toc-item-h2\"><a class=\"toc-link toc-link-h2\" href=\"#原因\">原因</a></li><li class=\"toc-item toc-item-h2\"><a class=\"toc-link toc-link-h2\" href=\"#影響\">影響</a></li><li class=\"toc-item toc-item-h2\"><a class=\"toc-link toc-link-h2\" href=\"#対応\">対応</a></li><li class=\"toc-item toc-item-h2\"><a class=\"toc-link toc-link-h2\" href=\"#2019327-時点での状況\">2019/3/27 時点での状況</a></li><li class=\"toc-item toc-item-h2\"><a class=\"toc-link toc-link-h2\" href=\"#2019422-追記\">2019/4/22 追記</a></li></ol></nav></div><h2 id=\"経緯\">経緯<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#経緯\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h2>\n\n<div class=\"blog-card\"><iframe src=\"https://blog-card-ten.vercel.app/card/https%3A%2F%2Fnot-wiz.net%2Frichtext-class%2F?id=blog-card-gelea5e9md&#x26;referrer=https%3A%2F%2Ftechnote.space%2Fposts%2Fwpxml-gutenberg-richtext-bug%2F\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" data-id=\"blog-card-gelea5e9md\"></iframe></div>\n\n<p>こちらの記事の現象が開発中のプラグインでも発生したため原因を調査しました。</p>\n\n<h2 id=\"現象\">現象<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#現象\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h2>\n\n<ol><li>クラスとタグ名を指定して registerFormatType でフォーマットタイプを登録</li><li>ビジュアルエディタのツールボタン等から登録したフォーマットタイプを適用</li><li>コードエディタでクラス名を変更または削除</li><li>ビジュアルエディタに戻る</li><li>同じタグ名で登録された<span class=\"double-underline\">無関係のフォーマットタイプが適用されているような表示</span>になる</li><li><span class=\"double-underline\">フロントでは５の適用は起こらない</span></li></ol>\n\n<h2 id=\"原因\">原因<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#原因\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h2>\n\n<p>原因はフォーマットタイプの検索時に以下のような実装になっているためです。</p>\n\n<ol><li>クラス名がある場合にクラス名で登録されたフォーマットタイプから検索</li><li>1で見つからなかった場合、タグ名のみで検索</li></ol>\n\n<div class=\"blog-card\"><iframe src=\"https://blog-card-ten.vercel.app/card/https%3A%2F%2Fgithub.com%2FWordPress%2Fgutenberg%2Fblob%2Frelease%2F5.4%2Fpackages%2Frich-text%2Fsrc%2Fcreate.js%23L40?id=blog-card-8n09sfvpvd&#x26;referrer=https%3A%2F%2Ftechnote.space%2Fposts%2Fwpxml-gutenberg-richtext-bug%2F\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" data-id=\"blog-card-8n09sfvpvd\"></iframe></div>\n\n<p>本来は２の検索時にクラス名がないものに限るべきだと思います。</p>\n\n<h2 id=\"影響\">影響<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#影響\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h2>\n\n<p>クラス名の付け外しによって見た目を変えるプラグインすべてでおかしな挙動になる可能性があります。</p>\n\n<p>とくに attributes に値が入っていることを前提としたコードになっている場合に、その attributes を持たない無関係のフォーマットが適用されるとエラーが発生します。</p>\n\n<p>RichTextの開発者のプラグインで実際にエラーを確認することが可能です。</p>\n\n<div class=\"blog-card\"><iframe src=\"https://blog-card-ten.vercel.app/card/https%3A%2F%2Fgithub.com%2Fellatrix%2Fadvanced-rich-text-tools%2Fblob%2Fmaster%2Fcolour.js%23L29?id=blog-card-akd129j8gg&#x26;referrer=https%3A%2F%2Ftechnote.space%2Fposts%2Fwpxml-gutenberg-richtext-bug%2F\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" data-id=\"blog-card-akd129j8gg\"></iframe></div>\n\n<h2 id=\"対応\">対応<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#対応\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h2>\n\n<p>とりあえずIssueで報告しました。</p>\n\n<div class=\"blog-card\"><iframe src=\"https://blog-card-ten.vercel.app/card/https%3A%2F%2Fgithub.com%2FWordPress%2Fgutenberg%2Fissues%2F13687?id=blog-card-khcfjoi0pt&#x26;referrer=https%3A%2F%2Ftechnote.space%2Fposts%2Fwpxml-gutenberg-richtext-bug%2F\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" data-id=\"blog-card-khcfjoi0pt\"></iframe></div>\n\n<h2 id=\"2019327-時点での状況\">2019/3/27 時点での状況<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#2019327-時点での状況\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h2>\n\n<p>RichTextの開発者のプラグインでも問題が発生するのですが、まだバグとして認識されていないようです。。。</p>\n\n<h2 id=\"2019422-追記\">2019/4/22 追記<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#2019422-追記\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h2>\n\n<p>別のバグの修正によってこのバグも修正されました。</p>\n\n<p>WordPress5.2 にも反映されるようです。</p>\n\n<div class=\"blog-card\"><iframe src=\"https://blog-card-ten.vercel.app/card/https%3A%2F%2Fgithub.com%2FWordPress%2Fgutenberg%2Fpull%2F15072?id=blog-card-c7doq10cdp&#x26;referrer=https%3A%2F%2Ftechnote.space%2Fposts%2Fwpxml-gutenberg-richtext-bug%2F\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" data-id=\"blog-card-c7doq10cdp\"></iframe></div>\n<!-- /wp:paragraph --></body></html>","excerpt":"経緯 こちらの記事の現象が開発中のプラグインでも発生したため原因を調査しました。   現象   1. クラスとタグ名を指定して registerFormatType でフォーマットタイプを登録  2. ビジュアルエディタのツールボタン等から...","postType":"post","tags":[{"slug":"gutenberg","name":"Gutenberg"},{"slug":"%e3%83%90%e3%82%b0","name":"バグ"},{"slug":"%e3%83%aa%e3%83%83%e3%83%81%e3%83%86%e3%82%ad%e3%82%b9%e3%83%88","name":"リッチテキスト"}],"thumbnail":"https://raw.githubusercontent.com/technote-space/my-blog-assets/main/uploads/2018/12/banner-772x250.jpg","dominantColor":"rgba(111,111,111,1)","createdAt":"2019-02-06T08:18:46.000Z","updatedAt":null},"prev":null,"next":{"id":"markdown-2021-09-27-test-toc","title":"目次の動作テスト","excerpt":"目次の動作テスト 見出し２のテスト１  これは１つめの見出し２です。  見出し２のテスト２  これは２つめの見出し２です。  見出し３のテスト１  これは１つめの見出し３です。  見出し３のテスト２  これは２つめの見出し３です。  見出し...","postType":"post","thumbnail":"/images/pet_cat_oddeye_black.png","createdAt":"2021-09-26T15:00:00.000Z","updatedAt":"2021-11-06T15:00:00.000Z"},"headerPages":[],"footerPages":[{"label":"About","url":"/pages/wpxml-about/"},{"label":"プライバシーポリシー","url":"/pages/wpxml-privacy-policy/"},{"label":"お問い合わせ","url":"/pages/wpxml-contact/"}]},"__N_SSG":true}