{"pageProps":{"post":{"id":"wpxml-yuzo-related-posts-vulnerability","title":"yuzo related posts から学ぶ脆弱性を含むプラグインやテーマの特徴","content":"<html><head></head><body><div class=\"toc-wrapper\"><input type=\"checkbox\" class=\"toc-checkbox\" id=\"toc-checkbox-khjj3tqkn8\" checked><label class=\"toc-title\" for=\"toc-checkbox-khjj3tqkn8\">目次</label><nav class=\"toc\"><ol class=\"toc-level toc-level-1\"><li class=\"toc-item toc-item-h2\"><a class=\"toc-link toc-link-h2\" href=\"#１コードが汚い\">１．コードが汚い</a></li><li class=\"toc-item toc-item-h2\"><a class=\"toc-link toc-link-h2\" href=\"#２通常あるべき処理の不足\">２．通常あるべき処理の不足</a></li><li class=\"toc-item toc-item-h2\"><a class=\"toc-link toc-link-h2\" href=\"#３必要な処理の不足\">３．必要な処理の不足</a></li><li class=\"toc-item toc-item-h2\"><a class=\"toc-link toc-link-h2\" href=\"#４不適切な情報送信\">４．不適切な情報送信</a></li><li class=\"toc-item toc-item-h2\"><a class=\"toc-link toc-link-h2\" href=\"#まとめ\">まとめ</a></li></ol></nav></div><p>4/10 ごろから yuzo related posts というプラグインが原因でJavaScriptが注入され、閲覧者が詐欺サイトへ飛ばされるという事例が多く発生しています。</p>\n\n<p><span class=\"double-underline\">公式ディレクトリに登録されていても安全とは限りません。</span></p>\n\n<p>公式ディレクトリへの登録は最初に一度レビューされるだけで、そのあとはどんな変更もやり放題です。</p>\n\n<p>プラグインやテーマの利用はGPLなので基本的に自己責任ですが、それによって閲覧者が攻撃にさらされる事態になるのは非常によろしくありません。</p>\n\n<p>ここでは脆弱性を含む可能性のあるプラグインやテーマの使用を避けるために確認すべき点をいくつか挙げておきます。</p>\n\n<h2 id=\"１コードが汚い\">１．コードが汚い<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#１コードが汚い\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h2>\n\n<ul><li>インデントや空白が適切ではない</li><li>スネークケースとキャメルケースが混ざっている</li><li>ディレクトリ構造が適切ではない</li><li>error や warning が1つ以上放置されている</li><li>一つ一つのメソッドの処理が異様に長い</li><li>ロジックとレンダリングが混ざっている</li><li>PHPDoc がない または 実装とあっていない</li></ul>\n\n<p>どれかひとつでも当てはまっている場合はプログラミングに不慣れな可能性が非常に高く、使用には注意が必要です。</p>\n\n<p>このプラグインはすべてを満たしています。</p>\n\n<ul class=\"wp-block-gallery columns-3 is-cropped\"><li class=\"blocks-gallery-item\"><figure><a href=\"https://technote.space/uploads/2019/04/04111819.png\"><img src=\"https://technote.space/uploads/2019/04/04111819.png\" alt=\"\" data-id=\"1450\" data-link=\"/wordpress/yuzo-related-posts-vulnerability/attachment/04111819\" class=\"wp-image-1450\"></a></figure></li><li class=\"blocks-gallery-item\"><figure><a href=\"https://technote.space/uploads/2019/04/04112107.png\"><img src=\"https://technote.space/uploads/2019/04/04112107.png\" alt=\"\" data-id=\"1460\" data-link=\"/wordpress/yuzo-related-posts-vulnerability/attachment/04112107\" class=\"wp-image-1460\"></a></figure></li><li class=\"blocks-gallery-item\"><figure><a href=\"https://technote.space/uploads/2019/04/04111832.png\"><img src=\"https://technote.space/uploads/2019/04/04111832.png\" alt=\"\" data-id=\"1451\" data-link=\"/wordpress/yuzo-related-posts-vulnerability/attachment/04111832\" class=\"wp-image-1451\"></a></figure></li></ul>\n\n<h2 id=\"２通常あるべき処理の不足\">２．通常あるべき処理の不足<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#２通常あるべき処理の不足\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h2>\n\n<ul><li>アンインストール時の処理がない (プラグインで追加した設定の削除など) </li><li>タイムゾーンを考慮した日付処理になっていない</li><li>必要なページだけで js や css を読み込むようになっていない</li><li>PHPファイルに直接アクセスされていないかどうかのチェックを行っていない</li></ul>\n\n<p>どれかひとつでも当てはまっている場合はWordPressの開発に不慣れな可能性が高く、使用する際はソースコードを確認して問題ないことを確かめるべきです。 </p>\n\n<p>このプラグインはすべて満たしています。</p>\n\n<h2 id=\"３必要な処理の不足\">３．必要な処理の不足<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#３必要な処理の不足\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h2>\n\n<ul><li><span class=\"double-underline\">権限のチェックがない</span> (<em>current_user_can</em> などのチェックがない)</li><li><span class=\"double-underline\">nonceチェックがない</span> (<em>wp_verify_nonce</em> 、<em>check_admin_referer</em> 、 <em>check_ajax_referer</em> などのチェックがない)</li><li><span class=\"double-underline\">値の検証やエスケープ処理なしで echo</span> が使用されている<ul><li>$_GET や $_POST はもちろんですが 保存された値も意図しない書き換えの可能性があるのでエスケープが必要です。</li></ul></li><li>SQLで変数を使用する際に<span class=\"double-underline\">プレースホルダーを使用していない</span></li></ul>\n\n<p>どれかひとつでも当てはまっている場合はセキュリティに関する考慮がされていません。<br>絶対に使用してはいけません。</p>\n\n<p>このプラグインはこれもすべて満たしています。</p>\n\n<ul class=\"wp-block-gallery columns-2 is-cropped\"><li class=\"blocks-gallery-item\"><figure><a href=\"https://technote.space/uploads/2019/04/04120246-1024x241.png\"><img src=\"https://technote.space/uploads/2019/04/04120246-1024x241.png\" alt=\"\" data-id=\"1475\" data-link=\"/wordpress/yuzo-related-posts-vulnerability/attachment/04120246\" class=\"wp-image-1475\"></a></figure></li><li class=\"blocks-gallery-item\"><figure><a href=\"https://technote.space/uploads/2019/04/04120325.png\"><img src=\"https://technote.space/uploads/2019/04/04120325.png\" alt=\"\" data-id=\"1476\" data-link=\"/wordpress/yuzo-related-posts-vulnerability/attachment/04120325\" class=\"wp-image-1476\"></a></figure></li></ul>\n\n<h2 id=\"４不適切な情報送信\">４．不適切な情報送信<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#４不適切な情報送信\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h2>\n\n<ul><li>ユーザの同意なしに以下のような情報を送信している<ul><li>管理者の表示名</li><li><span class=\"double-underline\">管理者のメールアドレス</span></li><li>サーバIPから導出された以下の情報<ul><li>緯度経度</li><li>国名コード</li><li>地域など</li></ul></li></ul></li></ul>\n\n<p>このプラグインは有効化時にこれらを送信する仕組みになっています。</p>\n\n<p>別の関連記事プラグインでも同じようなことがあるのですが、この手のプラグインではよくあることなのでしょうか？</p>\n\n<p>それとも海外製のプラグインでは普通なのでしょうか？</p>\n\n<div class=\"blog-card\"><iframe src=\"https://blog-card-ten.vercel.app/card/https%3A%2F%2Ftechnote.space%2Fsecurity%2Fwordpress-related-posts?id=blog-card-ko64naodv3&#x26;referrer=https%3A%2F%2Ftechnote.space%2Fposts%2Fwpxml-yuzo-related-posts-vulnerability%2F\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" data-id=\"blog-card-ko64naodv3\"></iframe></div>\n\n<p>ただ今回はIPなどだけでなくメールアドレスまで勝手に取得しており、非常にまずいのではないかと思います。</p>\n\n<h2 id=\"まとめ\">まとめ<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#まとめ\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h2>\n\n<p>yuzo related posts は60000以上のサイトでアクティブだったにもかかわらず、誰も脆弱性や不審な動作などに気が付かなかったようです。</p>\n\n<div class=\"blog-card\"><iframe src=\"https://blog-card-ten.vercel.app/card/https%3A%2F%2Ftechnote.space%2Fsecurity%2Ftroublesome?id=blog-card-4amgnuf89e&#x26;referrer=https%3A%2F%2Ftechnote.space%2Fposts%2Fwpxml-yuzo-related-posts-vulnerability%2F\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" data-id=\"blog-card-4amgnuf89e\"></iframe></div>\n\n<p>以前紹介したようにクラウドソーシングでは発注者は機能さえ動いていれば満足で裏で<span class=\"double-underline\">致命的な脆弱性が埋め込まれていても高評価</span>を付けていることは知っていましたが、割と気を使ってそうな企業でも結局同じような意識だとわかり少し残念な気持ちになりました。</p>\n\n<div class=\"blog-card\"><iframe src=\"https://blog-card-ten.vercel.app/card/https%3A%2F%2Faxia.co.jp%2F2019-01-31?id=blog-card-7u6na4j8vk&#x26;referrer=https%3A%2F%2Ftechnote.space%2Fposts%2Fwpxml-yuzo-related-posts-vulnerability%2F\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" data-id=\"blog-card-7u6na4j8vk\"></iframe></div>\n\n<figure class=\"wp-block-embed-twitter wp-block-embed is-type-rich is-provider-twitter\"><div class=\"wp-block-embed__wrapper\">\n<div class=\"embed-tweet\"><blockquote class=\"twitter-tweet\" style=\"display:none\"><a href=\"https://twitter.com/nishishi/status/1115976974927687680\"></a></blockquote></div>\n</div></figure>\n<!-- /wp:core-embed/twitter --></body></html>","excerpt":"4/10 ごろから yuzo related posts というプラグインが原因でJavaScriptが注入され、閲覧者が詐欺サイトへ飛ばされるという事例が多く発生しています。 公式ディレクトリに登録されていても安全とは限りません。 公式デ...","postType":"post","tags":[{"slug":"%e3%82%bb%e3%82%ad%e3%83%a5%e3%83%aa%e3%83%86%e3%82%a3","name":"セキュリティ"},{"slug":"%e8%84%86%e5%bc%b1%e6%80%a7","name":"脆弱性"}],"thumbnail":"https://technote.space/uploads/2018/11/computer_virus_backdoor.png","dominantColor":"rgba(171,173,174,0.3686274509803922)","createdAt":"2019-04-11T10:25:06.000Z","updatedAt":null},"prev":null,"next":{"id":"markdown-2022-08-13-makefile-change-command-dynamically","title":"Makefile で 動的にコマンドを変える方法","excerpt":"概要 使用できるコマンドかどうかチェックして、使用できない場合は別のコマンドを使用するみたいなことをやりたかったので  例えば、docker-compose がインストールされている場合はそれを使用、それ以外の場合は docker comp...","postType":"post","tags":[{"slug":"makefile","name":"makefile"}],"thumbnail":null,"createdAt":"2022-08-12T15:00:00.000Z","updatedAt":"2022-08-12T15:00:00.000Z"},"headerPages":[],"footerPages":[{"label":"About","url":"/pages/wpxml-about/"},{"label":"プライバシーポリシー","url":"/pages/wpxml-privacy-policy/"},{"label":"お問い合わせ","url":"/pages/wpxml-contact/"}]},"__N_SSG":true}