{"pageProps":{"post":{"id":"wpxml-wordpress-gutenberg-domready","title":"GutenbergエディタのDOMを操作をしたい場合","content":"<html><head></head><body><div class=\"toc-wrapper\"><input type=\"checkbox\" class=\"toc-checkbox\" id=\"toc-checkbox-d7r98jspjc\" checked><label class=\"toc-title\" for=\"toc-checkbox-d7r98jspjc\">目次</label><nav class=\"toc\"><ol class=\"toc-level toc-level-1\"><li class=\"toc-item toc-item-h2\"><a class=\"toc-link toc-link-h2\" href=\"#wpdomready\">wp.domReady</a></li><li class=\"toc-item toc-item-h2\"><a class=\"toc-link toc-link-h2\" href=\"#注意点\">注意点</a></li></ol></nav></div><p>今までのエディタでは「tiny_mce_before_init」フィルタなどのフックでクラスを付与したり色々な設定を変更したりすることができました。</p>\n\n<p>Gutenbergでは同様の方法をとることができません。</p>\n\n<p>新たに<span class=\"double-underline\">DOMの構築後に実行するコールバックを登録する方法</span>が提供されているため、それを利用することで様々なことが簡単に実現できます。</p>\n\n<h2 id=\"wpdomready\">wp.domReady<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#wpdomready\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h2>\n\n<div class=\"blog-card\"><iframe src=\"https://blog-card-ten.vercel.app/card/https%3A%2F%2Fwordpress.org%2Fgutenberg%2Fhandbook%2Fdesigners-developers%2Fdevelopers%2Fpackages%2Fpackages-dom-ready%2F?id=blog-card-1blkp89p5l&#x26;referrer=https%3A%2F%2Ftechnote.space%2Fposts%2Fwpxml-wordpress-gutenberg-domready%2F\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" data-id=\"blog-card-1blkp89p5l\"></iframe></div>\n\n<pre class=\"language-js\" style=\"background: #2e3440\"><code class=\"language-js\"><span style=\"color: #D8DEE9\">wp</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #88C0D0\">domReady</span><span style=\"color: #D8DEE9FF\">(</span><span style=\"color: #81A1C1\">function</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">()</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #ECEFF4\">    </span><span style=\"color: #4C566A\">// editor root</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #81A1C1\">const</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">target</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">=</span><span style=\"color: #D8DEE9FF\"> document</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #88C0D0\">getElementById</span><span style=\"color: #D8DEE9FF\">(</span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #A3BE8C\">editor</span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #D8DEE9FF\">)</span><span style=\"color: #81A1C1\">;</span>\n\n<span style=\"color: #ECEFF4\">    </span><span style=\"color: #4C566A\">// visual editor</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #81A1C1\">const</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">editor</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">=</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #8FBCBB\">target</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #88C0D0\">getElementsByClassName</span><span style=\"color: #D8DEE9FF\">(</span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #A3BE8C\">editor-writing-flow</span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #D8DEE9FF\">)</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #8FBCBB\">Array</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #D8DEE9FF\">prototype</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #D8DEE9\">forEach</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #88C0D0\">call</span><span style=\"color: #D8DEE9FF\">(</span><span style=\"color: #D8DEE9\">editor</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">e</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">=></span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">e</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #D8DEE9\">classList</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #88C0D0\">add</span><span style=\"color: #D8DEE9FF\">(</span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #A3BE8C\">article</span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #D8DEE9FF\">))</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #ECEFF4\">}</span><span style=\"color: #D8DEE9FF\">)</span><span style=\"color: #81A1C1\">;</span></code></pre>\n\n<p>上のようなコードでビジュアルエディタに「article」というクラスを付与することが可能です。</p>\n\n<p>jQueryでの操作も可能です。</p>\n\n<pre class=\"wp-block-code\" style=\"background: #2e3440\"><code style=\"color: undefined\">wp.domReady(function() {\n    $('#editor .editor-writing-flow').addClass('article');\n});</code></pre>\n\n<h2 id=\"注意点\">注意点<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#注意点\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h2>\n\n<p>DOMの構築後に付与したクラスなどはビジュアルエディタとコードエディタの切り替えで外れてしまうため、別途対応が必要です。</p>\n\n<div class=\"blog-card\"><iframe src=\"https://blog-card-ten.vercel.app/card/https%3A%2F%2Ftechnote.space%2Fwordpress%2Fgutenberg-switch-block-editor?id=blog-card-mmnlhbuvvu&#x26;referrer=https%3A%2F%2Ftechnote.space%2Fposts%2Fwpxml-wordpress-gutenberg-domready%2F\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" data-id=\"blog-card-mmnlhbuvvu\"></iframe></div>\n<!-- /wp:paragraph --></body></html>","excerpt":"今までのエディタでは「tiny_mce_before_init」フィルタなどのフックでクラスを付与したり色々な設定を変更したりすることができました。 Gutenbergでは同様の方法をとることができません。 新たにDOMの構築後に実行するコ...","postType":"post","tags":[{"slug":"gutenberg","name":"Gutenberg"}],"thumbnail":"https://technote.space/uploads/2018/12/banner-772x250.jpg","dominantColor":"rgba(111,111,111,1)","createdAt":"2018-12-10T08:59:58.000Z","updatedAt":null},"prev":{"id":"wpxml-wordpress-gutenberg-editor-css-summary","title":"Gutenbergエディタとクラシックエディタの判定やCSSの読み込み方法まとめ","excerpt":"エディタの判定 以下の方法でGutenbergエディタ（ブロックエディタ）とクラシックエディタを判定することが可能です。 is_block_editorはWordPress5.0から使用できるメソッドです。 WordPress5.0未満でプ...","postType":"post","tags":[{"slug":"gutenberg","name":"Gutenberg"},{"slug":"%e3%82%af%e3%83%a9%e3%82%b7%e3%83%83%e3%82%af%e3%82%a8%e3%83%87%e3%82%a3%e3%82%bf","name":"クラシックエディタ"},{"slug":"%e3%83%96%e3%83%ad%e3%83%83%e3%82%af%e3%82%a8%e3%83%87%e3%82%a3%e3%82%bf","name":"ブロックエディタ"}],"thumbnail":"https://technote.space/uploads/2018/12/banner-772x250.jpg","createdAt":"2018-12-13T10:18:18.000Z","updatedAt":null},"next":{"id":"wpxml-wordpress-add-button-to-gutenberg","title":"Gutenbergエディタ（ブロックエディタ）にボタンを追加する","excerpt":"WordPressのバージョンが5.0になり、エディタが新しくなりました。 これまでのTinyMCEとは異なりReactを利用したモダンな実装になっており、エディタへの機能の追加方法も大きく変わりました。  ここでは選択した文字列を特定のク...","postType":"post","tags":[{"slug":"gutenberg","name":"Gutenberg"},{"slug":"richtext","name":"RichText"},{"slug":"%e3%82%ab%e3%82%b9%e3%82%bf%e3%83%9e%e3%82%a4%e3%82%ba","name":"カスタマイズ"},{"slug":"%e3%83%aa%e3%83%83%e3%83%81%e3%83%86%e3%82%ad%e3%82%b9%e3%83%88","name":"リッチテキスト"}],"thumbnail":"https://technote.space/uploads/2018/12/201812080407.png","createdAt":"2018-12-07T21:16:36.000Z","updatedAt":null},"headerPages":[],"footerPages":[{"label":"About","url":"/pages/wpxml-about/"},{"label":"プライバシーポリシー","url":"/pages/wpxml-privacy-policy/"},{"label":"お問い合わせ","url":"/pages/wpxml-contact/"}]},"__N_SSG":true}