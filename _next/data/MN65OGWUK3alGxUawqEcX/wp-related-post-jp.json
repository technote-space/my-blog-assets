{"pageProps":{"post":{"id":"wpxml-wp-related-post-jp","title":"Elasticsearchのような検索機能を提供するためのWordPressのプラグインを開発しました","content":"<html><head></head><body><div class=\"toc-wrapper\"><input type=\"checkbox\" class=\"toc-checkbox\" id=\"toc-checkbox-2o0rl8ep24\" checked><label class=\"toc-title\" for=\"toc-checkbox-2o0rl8ep24\">目次</label><nav class=\"toc\"><ol class=\"toc-level toc-level-1\"><li class=\"toc-item toc-item-h2\"><a class=\"toc-link toc-link-h2\" href=\"#動作要件\">動作要件</a></li><li class=\"toc-item toc-item-h2\"><a class=\"toc-link toc-link-h2\" href=\"#導入手順\">導入手順</a></li><li class=\"toc-item toc-item-h2\"><a class=\"toc-link toc-link-h2\" href=\"#特徴\">特徴</a><ol class=\"toc-level toc-level-2\"><li class=\"toc-item toc-item-h3\"><a class=\"toc-link toc-link-h3\" href=\"#elasticsearchのようなanalyzer\">ElasticsearchのようなAnalyzer</a></li><li class=\"toc-item toc-item-h3\"><a class=\"toc-link toc-link-h3\" href=\"#okapi-bm25-アルゴリズムによる文章類似度計算\">Okapi BM25 アルゴリズムによる文章類似度計算</a></li></ol></li><li class=\"toc-item toc-item-h2\"><a class=\"toc-link toc-link-h2\" href=\"#主な設定\">主な設定</a></li><li class=\"toc-item toc-item-h2\"><a class=\"toc-link toc-link-h2\" href=\"#関連記事を表示\">関連記事を表示</a></li><li class=\"toc-item toc-item-h2\"><a class=\"toc-link toc-link-h2\" href=\"#インデックス対象を変更\">インデックス対象を変更</a></li><li class=\"toc-item toc-item-h2\"><a class=\"toc-link toc-link-h2\" href=\"#関連記事の表示を変更\">関連記事の表示を変更</a><ol class=\"toc-level toc-level-2\"><li class=\"toc-item toc-item-h3\"><a class=\"toc-link toc-link-h3\" href=\"#変更例\">変更例</a></li></ol></li><li class=\"toc-item toc-item-h2\"><a class=\"toc-link toc-link-h2\" href=\"#要望バグ報告等\">要望・バグ報告等</a></li><li class=\"toc-item toc-item-h2\"><a class=\"toc-link toc-link-h2\" href=\"#まとめ\">まとめ</a></li></ol></nav></div><p>WordPressはデフォルトでキーワード検索機能がありますが、精度はあまりよくありません。</p>\n\n<p>具体的には、例えば「php wordpress 管理サイト」のように検索した場合、<span class=\"double-underline\">これらすべての単語を含んでいる記事しか引っかかりません。</span></p>\n\n<figure class=\"wp-block-image\"><a href=\"https://technote.space/uploads/2018/10/201810020423.png\"><img src=\"https://technote.space/uploads/2018/10/201810020423-300x154.png\" alt=\"\" class=\"wp-image-249\"></a></figure>\n\n<p>「wordpress」や「管理画面」が含まれる記事に検索者が知りたい情報があった可能性もありますが、検索者はあきらめて別のサイトに移動してしまうかもしれません。</p>\n\n<p>Elasticsearchと呼ばれる全文検索エンジンの場合、検索ワードをすべて含んでいなくても検索結果に表示させることができます。</p>\n\n<div class=\"blog-card\"><iframe src=\"https://blog-card-ten.vercel.app/card/https%3A%2F%2Fqiita.com%2Fr548%2Fitems%2F3622048a622d9c0acc05?id=blog-card-n00a3h9feh&#x26;referrer=https%3A%2F%2Ftechnote.space%2Fposts%2Fwpxml-wp-related-post-jp%2F\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" data-id=\"blog-card-n00a3h9feh\"></iframe></div>\n\n<div class=\"blog-card\"><iframe src=\"https://blog-card-ten.vercel.app/card/https%3A%2F%2Fqiita.com%2Fnskydiving%2Fitems%2F1c2dc4e0b9c98d164329?id=blog-card-r45qbb5so0&#x26;referrer=https%3A%2F%2Ftechnote.space%2Fposts%2Fwpxml-wp-related-post-jp%2F\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" data-id=\"blog-card-r45qbb5so0\"></iframe></div>\n\n<p>検索ワードを含むかではなく、<span class=\"double-underline\">検索ワードにどれくらいマッチしているかを評価</span>し、評価の高い順に結果を返してくれるためです。</p>\n\n<p>Elasticsearchは検索を劇的に改善してくれますが、使用するにはサーバにインストールしたりElastic Cloudのようなクラウドサービスを利用する必要があります。</p>\n\n<p>今回作成したプラグインはそのElasticsearchのような全文検索を可能にするものです。</p>\n\n<p>通常のプラグインと同様に導入することができ、別途必要なものはありません。</p>\n\n<div class=\"blog-card\"><iframe src=\"https://blog-card-ten.vercel.app/card/https%3A%2F%2Fgithub.com%2Ftechnote-space%2Fwp-related-post-jp?id=blog-card-l958ehrcmo&#x26;referrer=https%3A%2F%2Ftechnote.space%2Fposts%2Fwpxml-wp-related-post-jp%2F\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" data-id=\"blog-card-l958ehrcmo\"></iframe></div>\n\n<h2 id=\"動作要件\">動作要件<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#動作要件\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h2>\n\n<p>PHP5.6以上が必要です。</p>\n\n<h2 id=\"導入手順\">導入手順<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#導入手順\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h2>\n\n<ol><li>githubからZIPをダウンロード　<a class=\"btn btn-light-green btn-m\" href=\"https://github.com/technote-space/wp-related-post-jp/releases/latest/download/release.zip\" target=\"_blank\" rel=\"noopener noreferrer\">ダウンロード</a></li><li>wp-content/plugins に展開</li><li>管理画面から有効化</li><li>左メニュー「Related Post」 > 「進捗」から「インデックス処理を有効化」を押下</li></ol>\n\n<figure class=\"wp-block-image\"><a href=\"https://technote.space/uploads/2018/10/201810020421.png\"><img src=\"https://technote.space/uploads/2018/10/201810020421-300x242.png\" alt=\"\" class=\"wp-image-246\"></a></figure>\n\n<figure class=\"wp-block-image\"><a href=\"https://technote.space/uploads/2018/10/201810020422.png\"><img src=\"https://technote.space/uploads/2018/10/201810020422-300x180.png\" alt=\"\" class=\"wp-image-247\"></a></figure>\n\n<p>以上の手順で有効化しますが、処理が終わるまではキーワード検索に使用されません。</p>\n\n<p>進捗状況は上記画面から確認できます。</p>\n\n<p>完了するとインデックスされた結果が使用されるようになります。</p>\n\n<figure class=\"wp-block-image\"><a href=\"https://technote.space/uploads/2018/10/201810020425.png\"><img src=\"https://technote.space/uploads/2018/10/201810020425-300x221.png\" alt=\"\" class=\"wp-image-250\"></a></figure>\n\n<h2 id=\"特徴\">特徴<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#特徴\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h2>\n\n<h3 id=\"elasticsearchのようなanalyzer\">ElasticsearchのようなAnalyzer<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#elasticsearchのようなanalyzer\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h3>\n\n<p>日本語の分かち書きにも対応しています。</p>\n\n<h3 id=\"okapi-bm25-アルゴリズムによる文章類似度計算\">Okapi BM25 アルゴリズムによる文章類似度計算<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#okapi-bm25-アルゴリズムによる文章類似度計算\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h3>\n\n<div class=\"blog-card\"><iframe src=\"https://blog-card-ten.vercel.app/card/https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FOkapi_BM25?id=blog-card-ic9g1oijt2&#x26;referrer=https%3A%2F%2Ftechnote.space%2Fposts%2Fwpxml-wp-related-post-jp%2F\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" data-id=\"blog-card-ic9g1oijt2\"></iframe></div>\n\n<div class=\"blog-card\"><iframe src=\"https://blog-card-ten.vercel.app/card/https%3A%2F%2Fmieruca-ai.com%2Fai%2Ftf-idf_okapi-bm25%2F?id=blog-card-tijk38gvud&#x26;referrer=https%3A%2F%2Ftechnote.space%2Fposts%2Fwpxml-wp-related-post-jp%2F\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" data-id=\"blog-card-tijk38gvud\"></iframe></div>\n\n<h2 id=\"主な設定\">主な設定<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#主な設定\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h2>\n\n<ul><li>バイグラムトークナイザーを使用するかどうか\n<ul>\n<li>true：<br>文字列を２文字ずつ取り出して文章を構成する単語として使用します。</li>\n<li>false：\n<ul>\n<li>ヤフーの設定をしている場合：<br>ヤフーの日本語形態素解析サービスを使用して単語を分割します。<br>利用制限があるため検索で使用する場合に制限に引っかかる可能性があります。</li>\n<li>ヤフーの設定をしていない場合：<br>Igoという形態素解析器を使用します。<br>ローカルで動作させるため利用制限等はありませんが処理速度等はサーバに依存します。</li>\n</ul>\n</li>\n</ul>\n</li></ul>\n\n<h2 id=\"関連記事を表示\">関連記事を表示<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#関連記事を表示\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h2>\n\n<p>インデックスされた情報は<span class=\"double-underline\">関連記事の表示に利用することが可能</span>です。</p>\n\n<p>関連記事を取得するクエリ生成前に以下のアクションを発行します。</p>\n\n<pre class=\"language-php\" style=\"background: #2e3440\"><code class=\"language-php\"><span style=\"color: #D8DEE9FF\">do_action( 'related_post/on_related_post' );</span></code></pre>\n\n<p>このアクションが発行された後の一回のみ、WP_Queryはこのプラグインで算出された関連記事を返します。</p>\n\n<p>例えば関連記事用のテンプレートを以下のように呼び出しているテーマの場合、</p>\n\n<pre class=\"language-php\" style=\"background: #2e3440\"><code class=\"language-php\"><span style=\"color: #D8DEE9FF\">get_template_part('related-list');</span></code></pre>\n\n<p>functions.php 等に記述するコードは以下のようになります。</p>\n\n<pre class=\"language-php\" style=\"background: #2e3440\"><code class=\"language-php\"><span style=\"color: #D8DEE9FF\">add_action( 'get_template_part_related-list', function () {</span>\n<span style=\"color: #D8DEE9FF\">\tdo_action( 'related_post/on_related_post' );</span>\n<span style=\"color: #D8DEE9FF\">} );</span></code></pre>\n\n<p>このプラグインの functions.php にはあらかじめ <a rel=\"nofollow noopener noreferrer\" href=\"https://wp-cocoon.com/\" target=\"_blank\">Cocoon</a> 及び <a href=\"https://wp-simplicity.com/\" target=\"_blank\" rel=\"noreferrer noopener\">Simplicity2</a> 用のコードが記述されているため、 それらのテーマを使用している方は別途設定は必要ありません。</p>\n\n<figure class=\"wp-block-image\"><a href=\"https://technote.space/uploads/2018/10/201810020457.png\"><img src=\"https://technote.space/uploads/2018/10/201810020457-300x207.png\" alt=\"\" class=\"wp-image-257\"></a></figure>\n\n<h2 id=\"インデックス対象を変更\">インデックス対象を変更<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#インデックス対象を変更\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h2>\n\n<p>デフォルトでは記事のタイトルと本文がインデックスの対象になっており、タイトルに重みづけがされています。</p>\n\n<pre class=\"language-php\" style=\"background: #2e3440\"><code class=\"language-php\"><span style=\"color: #D8DEE9FF\">str_repeat( $post->post_title . ' ', 3 ) . $post->post_content;</span></code></pre>\n\n<p>「本文のみ」「タイトルのみ」「タイトルと本文とタグ」を対象とする設定があらかじめ別途用意されています。</p>\n\n<p>以下のようなプログラムを functions.php などに記述することでそれらに変更することが可能です。</p>\n\n<pre class=\"language-php\" style=\"background: #2e3440\"><code class=\"language-php\"><span style=\"color: #D8DEE9FF\">add_filter( 'related_post/extractor', function () {</span>\n<span style=\"color: #D8DEE9FF\">\treturn 'content';            // 本文のみ</span>\n<span style=\"color: #D8DEE9FF\">//\treturn 'title';              // タイトルのみ</span>\n<span style=\"color: #D8DEE9FF\">//\treturn 'title_content_tags'; // タイトルと本文とタグ</span>\n<span style=\"color: #D8DEE9FF\">} );</span></code></pre>\n\n<p>さらに以下のようなプログラムを記述することで、カスタムフィールドなどを含め自由に対象を設定することが可能です。</p>\n\n<pre class=\"language-php\" style=\"background: #2e3440\"><code class=\"language-php\"><span style=\"color: #D8DEE9FF\">add_filter( 'related_post/extractor', function () {</span>\n<span style=\"color: #D8DEE9FF\">\treturn false;</span>\n<span style=\"color: #D8DEE9FF\">} );</span>\n<span style=\"color: #D8DEE9FF\">add_filter( 'related_post/extractor_result', function ($d, $post) {</span>\n<span style=\"color: #D8DEE9FF\">\treturn $post->title . ' ' . get_post_meta($post->ID, 'custom_field_key', true);</span>\n<span style=\"color: #D8DEE9FF\">} );</span></code></pre>\n\n<h2 id=\"関連記事の表示を変更\">関連記事の表示を変更<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#関連記事の表示を変更\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h2>\n\n<p><code>related_post/related_posts_content</code> をフィルタすることで関連記事の表示を変更することが可能です。</p>\n\n<h3 id=\"変更例\">変更例<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#変更例\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h3>\n\n<pre class=\"wp-block-code\" style=\"background: #2e3440\"><code style=\"color: undefined\">add_filter( 'related_post/related_posts_content', function (\n\t/** @noinspection PhpUnusedParameterInspection */\n\t$content, $control, $title, $post, $related_posts\n) {\n\t/** @var \\Related_Post\\Classes\\Models\\Control $control */\n\t/** @var string $title */\n\t/** @var array $related_posts */\n\tob_start();\n\t?>\n    &#x3C;style>\n        .related_posts_content {\n            margin: 10px;\n            padding: 10px;\n            border: #ccc 1px solid;\n            -webkit-transition: all 0.5s ease;\n            -moz-transition: all 0.5s ease;\n            -ms-transition: all 0.5s ease;\n            -o-transition: all 0.5s ease;\n            transition: all 0.5s ease;\n            background: white;\n        }\n\n        .related_posts_content:hover {\n            -webkit-box-shadow: #ccc 0 0 16px;\n            -moz-box-shadow: #ccc 0 0 16px;\n            box-shadow: #ccc 0 0 16px;\n            background: #f0ffff;\n        }\n\n        .link-item {\n            letter-spacing: -1em;\n        }\n\n        .link-item .thumbnail {\n            display: inline-block;\n            width: 20%;\n            margin: 0;\n            vertical-align: middle;\n        }\n\n        .link-item .thumbnail img {\n            vertical-align: middle;\n        }\n\n        .link-item .title {\n            display: inline-block;\n            -webkit-box-sizing: border-box;\n            -moz-box-sizing: border-box;\n            box-sizing: border-box;\n            width: 80%;\n            padding: 1em;\n            margin: 0;\n            font-weight: bold;\n            letter-spacing: normal;\n        }\n    &#x3C;/style>\n    &#x3C;div class=\"related_posts\">\n        &#x3C;h3 class=\"related_posts_title\">\n\t\t\t&#x3C;?php $control->h( $title ); ?>\n        &#x3C;/h3>\n        &#x3C;div class=\"related_posts_wrap\">\n\t\t\t&#x3C;?php foreach ( $related_posts as $related_post ): ?>\n\t\t\t\t&#x3C;?php /** @var WP_Post $related_post */ ?>\n                &#x3C;div class=\"related_posts_content\">\n\t\t\t\t\t&#x3C;?php $control->url( get_permalink( $related_post->ID ), &#x3C;&#x3C;&#x3C; EOS\n                    &#x3C;div class=\"link-item\">\n                        &#x3C;div class=\"thumbnail\">\n                            {$control->get_thumbnail( $related_post->ID )}\n                        &#x3C;/div>\n                        &#x3C;div class=\"title\">\n                            {$related_post->post_title}\n                        &#x3C;/div>\n                    &#x3C;/div>\nEOS\n\t\t\t\t\t\t, false, false, [], true, false ); ?>\n                &#x3C;/div>\n\t\t\t&#x3C;?php endforeach; ?>\n        &#x3C;/div>\n    &#x3C;/div>\n\t&#x3C;?php\n\n\t$view = ob_get_contents();\n\tob_end_clean();\n\n\treturn $view;\n}, 10, 5 );\n</code></pre>\n\n<p>以下のようなサムネイル付きの表示に変更されます。</p>\n\n<figure class=\"wp-block-image\"><a href=\"https://technote.space/uploads/2019/04/04171559.png\"><img src=\"https://technote.space/uploads/2019/04/04171559.png\" alt=\"\" class=\"wp-image-1532\"></a></figure>\n\n<h2 id=\"要望バグ報告等\">要望・バグ報告等<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#要望バグ報告等\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h2>\n\n<div class=\"blog-card\"><iframe src=\"https://blog-card-ten.vercel.app/card/https%3A%2F%2Fgithub.com%2Ftechnote-space%2Fwp-related-post-jp%2Fissues?id=blog-card-smgfnds3h0&#x26;referrer=https%3A%2F%2Ftechnote.space%2Fposts%2Fwpxml-wp-related-post-jp%2F\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" data-id=\"blog-card-smgfnds3h0\"></iframe></div>\n\n<h2 id=\"まとめ\">まとめ<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#まとめ\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h2>\n\n<p>検索はサイト内の別の記事を見てもらえるチャンスであり、検索結果に何もでなくなってしまうのは大きな損失になってしまいます。</p>\n\n<p>分散処理もできるElasticsearchの導入がおススメですが、それが困難な場合の代わりにはぜひプラグインを導入してみてください。</p>\n<!-- /wp:paragraph --></body></html>","excerpt":"WordPressはデフォルトでキーワード検索機能がありますが、精度はあまりよくありません。 具体的には、例えば「php wordpress 管理サイト」のように検索した場合、これらすべての単語を含んでいる記事しか引っかかりません。 「wo...","postType":"post","tags":[{"slug":"elasticsearch","name":"Elasticsearch"},{"slug":"wordpress","name":"WordPress"},{"slug":"wp-related-post-jp","name":"WP Related Post JP"},{"slug":"%e3%83%97%e3%83%a9%e3%82%b0%e3%82%a4%e3%83%b3","name":"プラグイン"}],"thumbnail":"https://technote.space/uploads/2018/10/logo-elastic.png","dominantColor":"rgba(159,174,152,0.3333333333333333)","createdAt":"2018-10-01T19:59:32.000Z","updatedAt":null},"prev":{"id":"wpxml-programming-server-monitoring","title":"Google Analyticsのリアルタイムレポートを利用してアクセス急増を監視","excerpt":"Google Analyticsのリアルタイムレポート機能とGoogle Apps Scriptを使用して簡単に簡易サーバ監視を作成できたのでその手順を記録しておきます。 機能 1. 15分おきにリアルタイムのユーザー数を取得  2. 設定...","postType":"post","tags":[{"slug":"gas","name":"GAS"},{"slug":"google-analytics","name":"Google Analytics"},{"slug":"slack","name":"Slack"},{"slug":"%e3%82%b5%e3%83%bc%e3%83%90%e7%9b%a3%e8%a6%96","name":"サーバ監視"}],"thumbnail":"https://technote.space/uploads/2018/10/computer_server.png","createdAt":"2018-10-02T19:14:38.000Z","updatedAt":null},"next":{"id":"wpxml-programming-intellij-functions/","title":"Intellijの便利機能まとめ","excerpt":"普段使用しているIDEのIntellijでよく使用する便利な機能のまとめ ショートカット よくまとまってるこちらが参考になります。  この中でも特によく使うものをいくつか   フォーマット  Windows：Ctrl + Alt + L M...","postType":"post","tags":[{"slug":"ide","name":"IDE"},{"slug":"intellij","name":"Intellij"},{"slug":"php","name":"PHP"},{"slug":"%e3%83%97%e3%83%ad%e3%82%b0%e3%83%a9%e3%83%9f%e3%83%b3%e3%82%b0","name":"プログラミング"}],"thumbnail":"https://technote.space/uploads/2018/10/intellij-idea.png","createdAt":"2018-09-30T15:13:46.000Z","updatedAt":null},"headerPages":[],"footerPages":[{"label":"About","url":"/pages/wpxml-about/"},{"label":"プライバシーポリシー","url":"/pages/wpxml-privacy-policy/"},{"label":"お問い合わせ","url":"/pages/wpxml-contact/"}]},"__N_SSG":true}