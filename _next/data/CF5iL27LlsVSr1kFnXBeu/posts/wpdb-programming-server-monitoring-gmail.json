{"pageProps":{"post":{"id":"wpxml-programming-server-monitoring-gmail","title":"GASとGmailの連携を試してみる","content":"<html><head></head><body><div class=\"toc-wrapper\"><input type=\"checkbox\" class=\"toc-checkbox\" id=\"toc-checkbox-1ikatt3svr\" checked><label class=\"toc-title\" for=\"toc-checkbox-1ikatt3svr\">目次</label><nav class=\"toc\"><ol class=\"toc-level toc-level-1\"><li class=\"toc-item toc-item-h2\"><a class=\"toc-link toc-link-h2\" href=\"#メール送信先をプロパティに設定\">メール送信先をプロパティに設定</a></li><li class=\"toc-item toc-item-h2\"><a class=\"toc-link toc-link-h2\" href=\"#プログラムを書き換える\">プログラムを書き換える</a></li><li class=\"toc-item toc-item-h2\"><a class=\"toc-link toc-link-h2\" href=\"#実行\">実行</a></li><li class=\"toc-item toc-item-h2\"><a class=\"toc-link toc-link-h2\" href=\"#まとめ\">まとめ</a></li></ol></nav></div>Google Analyticsのリアルタイムユーザ数をGASを使用してチェックして、閾値を超えたらslackに通知ことは簡単に実装できました。<br /><br /><div class=\"blog-card\"><iframe src=\"https://blog-card-ten.vercel.app/card/https%3A%2F%2Ftechnote.space%2Fprogramming%2Fserver-monitoring?id=blog-card-am1ljv7935&#x26;referrer=https%3A%2F%2Ftechnote.space%2Fposts%2Fwpxml-programming-server-monitoring-gmail%2F\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" data-id=\"blog-card-am1ljv7935\"></iframe></div><br /><br />ただ、slackを普段使用していない場合はメールのほうが便利かと思うので、その方法も試してみました。<br /><h2 id=\"メール送信先をプロパティに設定\">メール送信先をプロパティに設定<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#メール送信先をプロパティに設定\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h2><br /><ol><br /> \t<li>「ファイル」→「プロジェクトのプロパティ」を選択します。</li><br /> \t<li>スクリプトのプロパティに「MAIL_TO」で送信先を設定します。<a href=\"https://technote.space/uploads/2018/10/201810031423.png\"><img class=\"size-medium wp-image-297 aligncenter\" src=\"https://technote.space/uploads/2018/10/201810031423-300x78.png\" alt=\"\" width=\"300\" height=\"78\"></a></li><br /></ol><br /><h2 id=\"プログラムを書き換える\">プログラムを書き換える<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#プログラムを書き換える\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h2><br /><a href=\"/programming/server-monitoring\" rel=\"noreferrer noopener\" target=\"_blank\">前回</a>使用したプログラムを、Gmailを使用してメールするように書き換えます。<br /><br />送信先は上記で設定した「MAIL_TO」です。<br /><br />MailApp.sendEmail を使用することで簡単にメールを送ることが可能です。<br /><pre>function notify(number) {<br />  var THRESHOLD = PropertiesService.getScriptProperties().getProperty(\"THRESHOLD\");<br />  if (number > THRESHOLD) {<br />    //slack(getTitle(number, THRESHOLD), getMessage(number, THRESHOLD));<br />    mail(getTitle(number, THRESHOLD), getMessage(number, THRESHOLD));<br />  }<br />}<br /></pre><br /><pre>function mail(title, message) {<br />  var MAIL_TO = PropertiesService.getScriptProperties().getProperty(\"MAIL_TO\");<br />  MailApp.sendEmail(MAIL_TO, title, message);<br />}<br /></pre><br /><h2 id=\"実行\">実行<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#実行\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h2><br /><pre>function test() {<br />  notify(51);<br />}<br /></pre><br />のようなプログラムを追加し、「実行」→「関数を実行」から実行させてみます。<br /><br /><a href=\"https://technote.space/uploads/2018/10/201810031501.png\"><img class=\"alignnone size-medium wp-image-300\" src=\"https://technote.space/uploads/2018/10/201810031501-300x201.png\" alt=\"\" width=\"300\" height=\"201\"></a><br /><br />初めての実行時には承認が必要です。<br /><br /><a href=\"https://technote.space/uploads/2018/10/201810031419.png\"><img class=\"alignnone size-medium wp-image-301\" src=\"https://technote.space/uploads/2018/10/201810031419-300x127.png\" alt=\"\" width=\"300\" height=\"127\"></a><br /><br />「許可を確認」から承認します。<br /><br />一度承認すれば次回からは必要ないようです。<br /><br />上手くいけば以下のようなメールが届くはずです。<br /><br /><a href=\"https://technote.space/uploads/2018/10/201810031421.png\"><img class=\"alignnone size-medium wp-image-302\" src=\"https://technote.space/uploads/2018/10/201810031421-300x140.png\" alt=\"\" width=\"300\" height=\"140\"></a><br /><h2 id=\"まとめ\">まとめ<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#まとめ\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h2><br />GASはGoogleのサービスなだけあってGmailなどのサービスとの連携がとても簡単にできました。<br /><br />他の様々なサービスも含めてうまく組み合わせて使えれば非常に強力なツールを作成できると思うので、もっと活用していきたいと思います。</body></html>","excerpt":"Google Analyticsのリアルタイムユーザ数をGASを使用してチェックして、閾値を超えたらslackに通知ことは簡単に実装できました。 ただ、slackを普段使用していない場合はメールのほうが便利かと思うので、その方法も試してみま...","postType":"post","tags":[{"slug":"gas","name":"GAS"},{"slug":"google-analytics","name":"Google Analytics"}],"thumbnail":"https://technote.space/uploads/2018/10/computer_server.png","dominantColor":"rgba(157,156,157,0.7450980392156863)","createdAt":"2018-10-03T06:10:42.000Z","updatedAt":null},"prev":null,"next":{"id":"markdown-2021-09-27-test-toc","title":"目次の動作テスト","excerpt":"目次の動作テスト 見出し２のテスト１  これは１つめの見出し２です。  見出し２のテスト２  これは２つめの見出し２です。  見出し３のテスト１  これは１つめの見出し３です。  見出し３のテスト２  これは２つめの見出し３です。  見出し...","postType":"post","tags":[{"slug":"test","name":"test"},{"slug":"テスト","name":"テスト"},{"slug":"toc","name":"toc"}],"thumbnail":"/images/pet_cat_oddeye_black.png","createdAt":"2021-09-26T15:00:00.000Z","updatedAt":"2021-11-06T15:00:00.000Z"},"headerPages":[],"footerPages":[{"label":"About","url":"/pages/wpxml-about/"},{"label":"プライバシーポリシー","url":"/pages/wpxml-privacy-policy/"},{"label":"お問い合わせ","url":"/pages/wpxml-contact/"}]},"__N_SSG":true}