{"pageProps":{"post":{"id":"wpxml-wordpress-add-button-to-gutenberg","title":"Gutenbergエディタ（ブロックエディタ）にボタンを追加する","content":"<html><head></head><body><div class=\"toc-wrapper\"><input type=\"checkbox\" class=\"toc-checkbox\" id=\"toc-checkbox-97df7ed9ro\" checked><label class=\"toc-title\" for=\"toc-checkbox-97df7ed9ro\">目次</label><nav class=\"toc\"><ol class=\"toc-level toc-level-1\"><li class=\"toc-item toc-item-h2\"><a class=\"toc-link toc-link-h2\" href=\"#実装するもの\">実装するもの</a></li><li class=\"toc-item toc-item-h2\"><a class=\"toc-link toc-link-h2\" href=\"#javascriptやcssを登録\">JavaScriptやCSSを登録</a></li><li class=\"toc-item toc-item-h2\"><a class=\"toc-link toc-link-h2\" href=\"#cssを編集\">CSSを編集</a></li><li class=\"toc-item toc-item-h2\"><a class=\"toc-link toc-link-h2\" href=\"#javascriptを編集\">JavaScriptを編集</a></li><li class=\"toc-item toc-item-h2\"><a class=\"toc-link toc-link-h2\" href=\"#動作確認\">動作確認</a></li><li class=\"toc-item toc-item-h2\"><a class=\"toc-link toc-link-h2\" href=\"#追記複数のボタンを追加\">追記：複数のボタンを追加</a></li><li class=\"toc-item toc-item-h2\"><a class=\"toc-link toc-link-h2\" href=\"#まとめ\">まとめ</a></li><li class=\"toc-item toc-item-h2\"><a class=\"toc-link toc-link-h2\" href=\"#追記プラグインを作成しました\">追記：プラグインを作成しました</a></li></ol></nav></div><p>WordPressのバージョンが5.0になり、エディタが新しくなりました。</p>\n\n<div class=\"blog-card\"><iframe src=\"https://blog-card-ten.vercel.app/card/https%3A%2F%2Fja.wordpress.org%2Fgutenberg%2F?id=blog-card-npt6q5org4&#x26;referrer=https%3A%2F%2Ftechnote.space%2Fposts%2Fwpxml-wordpress-add-button-to-gutenberg%2F\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" data-id=\"blog-card-npt6q5org4\"></iframe></div>\n\n<p>これまでのTinyMCEとは異なりReactを利用したモダンな実装になっており、エディタへの機能の追加方法も大きく変わりました。</p>\n\n<p>ここでは<span class=\"double-underline\">選択した文字列を特定のクラスを持ったspanで囲うボタン</span>の追加方法を紹介します。</p>\n\n<h2 id=\"実装するもの\">実装するもの<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#実装するもの\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h2>\n\n<figure class=\"wp-block-image\"><a href=\"https://technote.space/uploads/2018/12/201812080507.png\"><img src=\"https://technote.space/uploads/2018/12/201812080507-300x198.png\" alt=\"\" class=\"wp-image-615\"></a></figure>\n\n<p>PHPとJavaScript、CSSを編集します。</p>\n\n<p>PHP側は適当に作成したプラグインのmy_plugin.php、JavaScriptとCSSはそのプラグイン配下に作成することを想定しています。</p>\n\n<figure class=\"wp-block-image\"><a href=\"https://technote.space/uploads/2018/12/201812091443.png\"><img src=\"https://technote.space/uploads/2018/12/201812091443-300x167.png\" alt=\"\" class=\"wp-image-635\"></a></figure>\n\n<p><span class=\"double-underline\">今回はReactを使用しない方法</span>です。</p>\n\n<p>そのため<span class=\"double-underline\">フロントエンドのビルド環境の用意は必要ありません</span>。</p>\n\n<h2 id=\"javascriptやcssを登録\">JavaScriptやCSSを登録<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#javascriptやcssを登録\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h2>\n\n<p>TinyMCEの時はJavaScriptとCSSの登録は別々でしたが、Gutenbergでは<span class=\"double-underline\">「enqueue_block_editor_assets」アクションをフック</span>して「wp_enqueue_style」や「wp_enqueue_script」を使用して登録します。</p>\n\n<div class=\"blog-card\"><iframe src=\"https://blog-card-ten.vercel.app/card/https%3A%2F%2Felearn.jp%2Fwpman%2Ffunction%2Fwp_enqueue_style.html?id=blog-card-2lsqnehf5a&#x26;referrer=https%3A%2F%2Ftechnote.space%2Fposts%2Fwpxml-wordpress-add-button-to-gutenberg%2F\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" data-id=\"blog-card-2lsqnehf5a\"></iframe></div>\n\n<div class=\"blog-card\"><iframe src=\"https://blog-card-ten.vercel.app/card/https%3A%2F%2Felearn.jp%2Fwpman%2Ffunction%2Fwp_enqueue_script.html?id=blog-card-g6qfomuepu&#x26;referrer=https%3A%2F%2Ftechnote.space%2Fposts%2Fwpxml-wordpress-add-button-to-gutenberg%2F\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" data-id=\"blog-card-g6qfomuepu\"></iframe></div>\n\n<p>「wp_localize_script」でJavaScript側にデータを渡すことも可能です。<br>下の例ではボタンに表示されるタイトルとクラス名をPHP側から渡せるようにしています。</p>\n\n<div class=\"blog-card\"><iframe src=\"https://blog-card-ten.vercel.app/card/https%3A%2F%2Felearn.jp%2Fwpman%2Ffunction%2Fwp_localize_script.html?id=blog-card-pnfvs0v88f&#x26;referrer=https%3A%2F%2Ftechnote.space%2Fposts%2Fwpxml-wordpress-add-button-to-gutenberg%2F\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" data-id=\"blog-card-pnfvs0v88f\"></iframe></div>\n\n<p>ここでは「wp_enqueue_script」の依存関係に<span class=\"double-underline\">「wp-element」「wp-rich-text」「wp-editor」</span>を追加します。<br>後で追加するJavaScriptでこれらを使用するためで、もし他に依存するもの（<em>wp-data</em> や <em>wp-i18n</em> など）を使用する場合はそれらを追加します。 <br>ここで追加した依存関係によってJavaScriptファイルの読み込み順をWordPressが適切に判断してくれるようになります。</p>\n\n<p><em>my_plugin.php</em></p>\n\n<pre class=\"language-php\" style=\"background: #2e3440\"><code class=\"language-php\"><span style=\"color: #D8DEE9FF\">add_action( 'enqueue_block_editor_assets', function () {</span>\n<span style=\"color: #D8DEE9FF\">   wp_enqueue_style( 'my_plugin', plugins_url( 'assets/css/editor.css', __FILE__ ) );</span>\n<span style=\"color: #D8DEE9FF\">   wp_enqueue_script( 'my_plugin', plugins_url( 'assets/js/editor.js', __FILE__ ), [</span>\n<span style=\"color: #D8DEE9FF\">      'wp-element',</span>\n<span style=\"color: #D8DEE9FF\">      'wp-rich-text',</span>\n<span style=\"color: #D8DEE9FF\">      'wp-editor',</span>\n<span style=\"color: #D8DEE9FF\">   ] );</span>\n<span style=\"color: #D8DEE9FF\">   wp_localize_script( 'my_plugin', 'myPluginObj', [</span>\n<span style=\"color: #D8DEE9FF\">      'title' => 'My Plugin',</span>\n<span style=\"color: #D8DEE9FF\">      'class' => 'my-plugin',</span>\n<span style=\"color: #D8DEE9FF\">   ] );</span>\n<span style=\"color: #D8DEE9FF\">} );</span></code></pre>\n\n<h2 id=\"cssを編集\">CSSを編集<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#cssを編集\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h2>\n\n<p>クラスで囲われたかどうかをわかりやすくするため装飾します。</p>\n\n<p><em>assets/css/editor.css</em></p>\n\n<pre class=\"language-css\" style=\"background: #2e3440\"><code class=\"language-css\"><span style=\"color: #ECEFF4\">.</span><span style=\"color: #8FBCBB\">my-plugin</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #D8DEE9\">display</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #88C0D0\"> </span><span style=\"color: #81A1C1\">inline;</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #D8DEE9\">background-position</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #88C0D0\"> </span><span style=\"color: #81A1C1\">left</span><span style=\"color: #88C0D0\"> </span><span style=\"color: #B48EAD\">-100</span><span style=\"color: #81A1C1\">%</span><span style=\"color: #88C0D0\"> </span><span style=\"color: #81A1C1\">center;</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #D8DEE9\">background-repeat</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #88C0D0\"> </span><span style=\"color: #81A1C1\">repeat-x;</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #D8DEE9\">background-image</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #88C0D0\"> linear-gradient(to </span><span style=\"color: #81A1C1\">right</span><span style=\"color: #88C0D0\">, rgba</span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #B48EAD\">255, 255, 255, 0</span><span style=\"color: #ECEFF4\">)</span><span style=\"color: #88C0D0\"> </span><span style=\"color: #B48EAD\">50</span><span style=\"color: #81A1C1\">%</span><span style=\"color: #88C0D0\">, </span><span style=\"color: #ECEFF4\">#</span><span style=\"color: #B48EAD\">ff6</span><span style=\"color: #88C0D0\"> </span><span style=\"color: #B48EAD\">50</span><span style=\"color: #81A1C1\">%</span><span style=\"color: #88C0D0\">)</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #D8DEE9\">background-size</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #88C0D0\"> </span><span style=\"color: #B48EAD\">200</span><span style=\"color: #81A1C1\">%</span><span style=\"color: #88C0D0\"> </span><span style=\"color: #B48EAD\">.6</span><span style=\"color: #81A1C1\">em;</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #D8DEE9\">font-weight</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #88C0D0\"> </span><span style=\"color: #81A1C1\">bold;</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #D8DEE9\">padding-bottom</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #88C0D0\"> </span><span style=\"color: #B48EAD\">.6</span><span style=\"color: #81A1C1\">em;</span>\n<span style=\"color: #ECEFF4\">}</span></code></pre>\n\n<p>ここではクラスで囲われた箇所に蛍光ペンを引いたような装飾をつけています。</p>\n\n<p>この装飾はエディタ用です。</p>\n\n<p>実際にフロント側で何かデザインをつけるためには別途フロント用のCSSを用意して読み込ませるようにする必要があります。</p>\n\n<h2 id=\"javascriptを編集\">JavaScriptを編集<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#javascriptを編集\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h2>\n\n<p>先ほど依存関係に登録した「wp-element」「wp-rich-text」「wp-editor」はそれぞれ「window.wp.element」「window.wp.richText」「window.wp.editor」として使用できます。</p>\n\n<p>以下のように短い名前で使用できるようにしておきます。</p>\n\n<pre class=\"language-js\" style=\"background: #2e3440\"><code class=\"language-js\"><span style=\"color: #D8DEE9FF\">(</span><span style=\"color: #81A1C1\">function</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #D8DEE9\">richText</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">element</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">editor</span><span style=\"color: #ECEFF4\">)</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">    </span>\n<span style=\"color: #ECEFF4\">}</span><span style=\"color: #D8DEE9FF\">(</span>\n<span style=\"color: #D8DEE9FF\">    window</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #D8DEE9\">wp</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #D8DEE9\">richText</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">    window</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #D8DEE9\">wp</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #D8DEE9\">element</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">    window</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #D8DEE9\">wp</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #D8DEE9\">editor</span>\n<span style=\"color: #D8DEE9FF\">))</span><span style=\"color: #81A1C1\">;</span></code></pre>\n\n<p>ボタンを追加するには「richText」の「registerFormatType」を使用します。</p>\n\n<div class=\"blog-card\"><iframe src=\"https://blog-card-ten.vercel.app/card/https%3A%2F%2Fgithub.com%2FWordPress%2Fgutenberg%2Fblob%2Fmaster%2Fpackages%2Frich-text%2Fsrc%2Fregister-format-type.js?id=blog-card-5iqknadrda&#x26;referrer=https%3A%2F%2Ftechnote.space%2Fposts%2Fwpxml-wordpress-add-button-to-gutenberg%2F\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" data-id=\"blog-card-5iqknadrda\"></iframe></div>\n\n<p>ここでは「title」「tagName」「className」「edit」を登録します。</p>\n\n<p><em>assets/js/editor.js</em></p>\n\n<pre class=\"language-js\" style=\"background: #2e3440\"><code class=\"language-js\"><span style=\"color: #D8DEE9FF\">(</span><span style=\"color: #81A1C1\">function</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #D8DEE9\">richText</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">element</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">editor</span><span style=\"color: #ECEFF4\">)</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #81A1C1\">const</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">name</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">=</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #A3BE8C\">my-plugin/my-plugin</span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #D8DEE9\">richText</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #88C0D0\">registerFormatType</span><span style=\"color: #D8DEE9FF\">(</span><span style=\"color: #D8DEE9\">name</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #88C0D0\">title</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">myPluginObj</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #D8DEE9FF\">title</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #88C0D0\">tagName</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #A3BE8C\">span</span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #88C0D0\">className</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">myPluginObj</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #D8DEE9\">class</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #88C0D0\">edit</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">function</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">(</span><span style=\"color: #D8DEE9\">args</span><span style=\"color: #ECEFF4\">)</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">            </span><span style=\"color: #81A1C1\">return</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">element</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #88C0D0\">createElement</span><span style=\"color: #D8DEE9FF\">(</span><span style=\"color: #D8DEE9\">editor</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #D8DEE9\">RichTextToolbarButton</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">                </span><span style=\"color: #88C0D0\">icon</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #A3BE8C\">admin-customizer</span><span style=\"color: #ECEFF4\">'</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">                </span><span style=\"color: #88C0D0\">title</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">myPluginObj</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #D8DEE9FF\">title</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">                </span><span style=\"color: #88C0D0\">onClick</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #81A1C1\">function</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">()</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">                    </span><span style=\"color: #D8DEE9\">args</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #88C0D0\">onChange</span><span style=\"color: #D8DEE9FF\">(</span><span style=\"color: #D8DEE9\">richText</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #88C0D0\">toggleFormat</span><span style=\"color: #D8DEE9FF\">(</span><span style=\"color: #D8DEE9\">args</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #D8DEE9FF\">value</span><span style=\"color: #ECEFF4\">,</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #ECEFF4\">{</span>\n<span style=\"color: #D8DEE9FF\">                        </span><span style=\"color: #88C0D0\">type</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">name</span>\n<span style=\"color: #D8DEE9FF\">                    </span><span style=\"color: #ECEFF4\">}</span><span style=\"color: #D8DEE9FF\">))</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #D8DEE9FF\">                </span><span style=\"color: #ECEFF4\">},</span>\n<span style=\"color: #D8DEE9FF\">                </span><span style=\"color: #88C0D0\">isActive</span><span style=\"color: #ECEFF4\">:</span><span style=\"color: #D8DEE9FF\"> </span><span style=\"color: #D8DEE9\">args</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #D8DEE9\">isActive</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">            </span><span style=\"color: #ECEFF4\">}</span><span style=\"color: #D8DEE9FF\">)</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #D8DEE9FF\">        </span><span style=\"color: #ECEFF4\">},</span>\n<span style=\"color: #D8DEE9FF\">    </span><span style=\"color: #ECEFF4\">}</span><span style=\"color: #D8DEE9FF\">)</span><span style=\"color: #81A1C1\">;</span>\n<span style=\"color: #ECEFF4\">}</span><span style=\"color: #D8DEE9FF\">(</span>\n<span style=\"color: #D8DEE9FF\">    window</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #D8DEE9\">wp</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #D8DEE9\">richText</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">    window</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #D8DEE9\">wp</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #D8DEE9\">element</span><span style=\"color: #ECEFF4\">,</span>\n<span style=\"color: #D8DEE9FF\">    window</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #D8DEE9\">wp</span><span style=\"color: #ECEFF4\">.</span><span style=\"color: #D8DEE9\">editor</span>\n<span style=\"color: #D8DEE9FF\">))</span><span style=\"color: #81A1C1\">;</span></code></pre>\n\n<p><em>my_plugin.php</em> で <em>wp_localize_script</em>  を使用して登録したタイトルとクラス名をそれぞれ</p>\n\n<ul><li><em>myPluginObj.title</em></li><li><em>myPluginObj.class</em></li></ul>\n\n<p>として使用しています。<br>PHPから渡す必要がない場合は直接JavaScriptファイルにタイトルとクラス名を書いても動作します。</p>\n\n<p><em>editor.RichTextToolbarButton</em></p>\n\n<div class=\"blog-card\"><iframe src=\"https://blog-card-ten.vercel.app/card/https%3A%2F%2Fgithub.com%2FWordPress%2Fgutenberg%2Fblob%2Fmaster%2Fpackages%2Fblock-editor%2Fsrc%2Fcomponents%2Frich-text%2Ftoolbar-button.js?id=blog-card-g0kl7j11ru&#x26;referrer=https%3A%2F%2Ftechnote.space%2Fposts%2Fwpxml-wordpress-add-button-to-gutenberg%2F\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" data-id=\"blog-card-g0kl7j11ru\"></iframe></div>\n\n<p><em>ToolbarButton</em></p>\n\n<div class=\"blog-card\"><iframe src=\"https://blog-card-ten.vercel.app/card/https%3A%2F%2Fgithub.com%2FWordPress%2Fgutenberg%2Fblob%2Fmaster%2Fpackages%2Fcomponents%2Fsrc%2Ftoolbar-button%2Findex.js?id=blog-card-sk1e7chdb7&#x26;referrer=https%3A%2F%2Ftechnote.space%2Fposts%2Fwpxml-wordpress-add-button-to-gutenberg%2F\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" data-id=\"blog-card-sk1e7chdb7\"></iframe></div>\n\n<p>iconに設定するアイコンは以下のページから選択可能です。</p>\n\n<div class=\"blog-card\"><iframe src=\"https://blog-card-ten.vercel.app/card/https%3A%2F%2Fdeveloper.wordpress.org%2Fresource%2Fdashicons%2F%23admin-customizer?id=blog-card-8mp40gm9hm&#x26;referrer=https%3A%2F%2Ftechnote.space%2Fposts%2Fwpxml-wordpress-add-button-to-gutenberg%2F\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" data-id=\"blog-card-8mp40gm9hm\"></iframe></div>\n\n<div class=\"blog-card\"><iframe src=\"https://blog-card-ten.vercel.app/card/https%3A%2F%2Fgithub.com%2FWordPress%2Fgutenberg%2Fblob%2Fmaster%2Fpackages%2Fcomponents%2Fsrc%2Fdashicon%2Findex.js?id=blog-card-bf1k16vrp3&#x26;referrer=https%3A%2F%2Ftechnote.space%2Fposts%2Fwpxml-wordpress-add-button-to-gutenberg%2F\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" data-id=\"blog-card-bf1k16vrp3\"></iframe></div>\n\n<p>ここまでの処理で以下のようにボタンが追加されます。</p>\n\n<figure class=\"wp-block-image\"><a href=\"https://technote.space/uploads/2018/12/201812080507.png\"><img src=\"https://technote.space/uploads/2018/12/201812080507-300x198.png\" alt=\"\" class=\"wp-image-615\"></a></figure>\n\n<h2 id=\"動作確認\">動作確認<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#動作確認\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h2>\n\n<p>文字を選択した状態でボタンを押すと蛍光ペンを引いたような装飾がされました。</p>\n\n<figure class=\"wp-block-image\"><a href=\"https://technote.space/uploads/2018/12/201812080528.png\"><img src=\"https://technote.space/uploads/2018/12/201812080528-300x106.png\" alt=\"\" class=\"wp-image-617\"></a></figure>\n\n<p>「HTMLとして編集」から確認すると「my-plugin」クラスのspanで囲われていることが確認できます。</p>\n\n<figure class=\"wp-block-image\"><a href=\"https://technote.space/uploads/2018/12/201812080530.png\"><img src=\"https://technote.space/uploads/2018/12/201812080530-300x139.png\" alt=\"\" class=\"wp-image-618\"></a></figure>\n\n<p>装飾されている箇所にカーソルが当たっている状態だとボタンが選択されたような表示になり、この時にボタンを押すと装飾が外れ、「my-plugin」クラスのspanで囲われていたものが外れます。</p>\n\n<figure class=\"wp-block-image\"><a href=\"https://technote.space/uploads/2018/12/201812080534.png\"><img src=\"https://technote.space/uploads/2018/12/201812080534-300x184.png\" alt=\"\" class=\"wp-image-620\"></a></figure>\n\n<h2 id=\"追記複数のボタンを追加\">追記：複数のボタンを追加<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#追記複数のボタンを追加\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h2>\n\n<p>コメントで複数追加する場合の質問があったので追記します。</p>\n\n<pre class=\"wp-block-preformatted\">richText.registerFormatType&#x3C;br></pre>\n\n<p>を使用すればいくつでもボタンを追加ことが可能です。<br>ただし、同じクラス名や複数のクラス名を指定できません。</p>\n\n<div class=\"blog-card\"><iframe src=\"https://blog-card-ten.vercel.app/card/https%3A%2F%2Fgist.github.com%2Ftechnote-space%2Fa9d1ab7154b6e5d372e0aa8b0cd77faa?id=blog-card-rfq2m3d4e9&#x26;referrer=https%3A%2F%2Ftechnote.space%2Fposts%2Fwpxml-wordpress-add-button-to-gutenberg%2F\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" data-id=\"blog-card-rfq2m3d4e9\"></iframe></div>\n\n<h2 id=\"まとめ\">まとめ<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#まとめ\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h2>\n\n<p>Reactで作られた新しいエディタでも、ビルド環境を用意することなく割と気軽にエディタへの機能の追加が可能になっていることがわかりました。</p>\n\n<p>ブログのメイン機能と言っても過言ではないエディタへの大きな変更が今後のCMS界隈にどう影響していくのかが気になります。</p>\n\n<h2 id=\"追記プラグインを作成しました\">追記：プラグインを作成しました<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#追記プラグインを作成しました\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h2>\n\n<div class=\"blog-card\"><iframe src=\"https://blog-card-ten.vercel.app/card/https%3A%2F%2Fgithub.com%2Ftechnote-space%2Fadd-richtext-toolbar-button%23add-richtext-toolbar-button?id=blog-card-ug9lfahlj4&#x26;referrer=https%3A%2F%2Ftechnote.space%2Fposts%2Fwpxml-wordpress-add-button-to-gutenberg%2F\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" data-id=\"blog-card-ug9lfahlj4\"></iframe></div>\n\n<p>通常の方法では<span class=\"double-underline\">いくつかのボタンをまとめてドロップダウン</span>にしたり<span class=\"double-underline\">複数クラスを指定</span>したり<span class=\"double-underline\">カラーピッカーやフォントサイズピッカーを追加</span>できませんが、このプラグインではそれらが実現可能です。</p>\n\n<figure class=\"wp-block-image\"><a href=\"https://technote.space/uploads/2019/03/201903070308.gif\"><img src=\"https://technote.space/uploads/2019/03/201903070308.gif\" alt=\"\" class=\"wp-image-1155\"></a></figure>\n<!-- /wp:image --></body></html>","excerpt":"WordPressのバージョンが5.0になり、エディタが新しくなりました。 これまでのTinyMCEとは異なりReactを利用したモダンな実装になっており、エディタへの機能の追加方法も大きく変わりました。  ここでは選択した文字列を特定のク...","postType":"post","tags":[{"slug":"gutenberg","name":"Gutenberg"},{"slug":"richtext","name":"RichText"},{"slug":"%e3%82%ab%e3%82%b9%e3%82%bf%e3%83%9e%e3%82%a4%e3%82%ba","name":"カスタマイズ"},{"slug":"%e3%83%aa%e3%83%83%e3%83%81%e3%83%86%e3%82%ad%e3%82%b9%e3%83%88","name":"リッチテキスト"}],"thumbnail":"https://technote.space/uploads/2018/12/201812080407.png","dominantColor":"rgba(239,239,240,1)","createdAt":"2018-12-07T21:16:36.000Z","updatedAt":null},"prev":null,"next":{"id":"markdown-2021-09-27-test-toc","title":"目次の動作テスト","excerpt":"目次の動作テスト 見出し２のテスト１  これは１つめの見出し２です。  見出し２のテスト２  これは２つめの見出し２です。  見出し３のテスト１  これは１つめの見出し３です。  見出し３のテスト２  これは２つめの見出し３です。  見出し...","postType":"post","tags":[{"slug":"test","name":"test"},{"slug":"テスト","name":"テスト"},{"slug":"toc","name":"toc"}],"thumbnail":"/images/pet_cat_oddeye_black.png","createdAt":"2021-09-26T15:00:00.000Z","updatedAt":"2021-11-06T15:00:00.000Z"},"headerPages":[],"footerPages":[{"label":"About","url":"/pages/wpxml-about/"},{"label":"プライバシーポリシー","url":"/pages/wpxml-privacy-policy/"},{"label":"お問い合わせ","url":"/pages/wpxml-contact/"}]},"__N_SSG":true}