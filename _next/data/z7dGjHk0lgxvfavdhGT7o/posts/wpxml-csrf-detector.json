{"pageProps":{"post":{"id":"wpxml-csrf-detector","title":"CSRF検出プラグインを作成しました","content":"<html><head></head><body><div class=\"toc-wrapper\"><input type=\"checkbox\" class=\"toc-checkbox\" id=\"toc-checkbox-04ig7ap556\" checked><label class=\"toc-title\" for=\"toc-checkbox-04ig7ap556\">目次</label><nav class=\"toc\"><ol class=\"toc-level toc-level-1\"><li class=\"toc-item toc-item-h2\"><a class=\"toc-link toc-link-h2\" href=\"#github\">GitHub</a></li><li class=\"toc-item toc-item-h2\"><a class=\"toc-link toc-link-h2\" href=\"#機能\">機能</a></li><li class=\"toc-item toc-item-h2\"><a class=\"toc-link toc-link-h2\" href=\"#導入手順\">導入手順</a></li><li class=\"toc-item toc-item-h2\"><a class=\"toc-link toc-link-h2\" href=\"#設定\">設定</a><ol class=\"toc-level toc-level-2\"><li class=\"toc-item toc-item-h3\"><a class=\"toc-link toc-link-h3\" href=\"#検知したときに処理を終了させるかどうか\">検知したときに処理を終了させるかどうか</a></li><li class=\"toc-item toc-item-h3\"><a class=\"toc-link toc-link-h3\" href=\"#検知したときのメール送信先\">検知したときのメール送信先</a></li><li class=\"toc-item toc-item-h3\"><a class=\"toc-link toc-link-h3\" href=\"#監視するsqlコマンド\">監視するSQLコマンド</a></li><li class=\"toc-item toc-item-h3\"><a class=\"toc-link toc-link-h3\" href=\"#除外するオプションのパターン\">除外するオプションのパターン</a></li><li class=\"toc-item toc-item-h3\"><a class=\"toc-link toc-link-h3\" href=\"#getメソッドを除外するかどうか\">GETメソッドを除外するかどうか</a></li><li class=\"toc-item toc-item-h3\"><a class=\"toc-link toc-link-h3\" href=\"#管理画面以外を除外するかどうか\">管理画面以外を除外するかどうか</a></li><li class=\"toc-item toc-item-h3\"><a class=\"toc-link toc-link-h3\" href=\"#同じホストからの送信を除外するかどうか\">同じホストからの送信を除外するかどうか</a></li><li class=\"toc-item toc-item-h3\"><a class=\"toc-link toc-link-h3\" href=\"#管理画面からの送信を除外するかどうか\">管理画面からの送信を除外するかどうか</a></li></ol></li><li class=\"toc-item toc-item-h2\"><a class=\"toc-link toc-link-h2\" href=\"#アクションの実行\">アクションの実行</a></li><li class=\"toc-item toc-item-h2\"><a class=\"toc-link toc-link-h2\" href=\"#要件\">要件</a></li><li class=\"toc-item toc-item-h2\"><a class=\"toc-link toc-link-h2\" href=\"#注意事項\">注意事項</a></li><li class=\"toc-item toc-item-h2\"><a class=\"toc-link toc-link-h2\" href=\"#要望バグ報告等\">要望・バグ報告等</a></li><li class=\"toc-item toc-item-h2\"><a class=\"toc-link toc-link-h2\" href=\"#今後の予定等\">今後の予定等</a></li><li class=\"toc-item toc-item-h2\"><a class=\"toc-link toc-link-h2\" href=\"#使用しているフレームワーク\">使用しているフレームワーク</a></li><li class=\"toc-item toc-item-h2\"><a class=\"toc-link toc-link-h2\" href=\"#このプラグインで検知した脆弱性履歴随時更新\">このプラグインで検知した脆弱性履歴（随時更新）</a></li></ol></nav></div><h2 id=\"github\">GitHub<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#github\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h2>\n\n<div class=\"blog-card\"><iframe src=\"https://blog-card-ten.vercel.app/card/https%3A%2F%2Fgithub.com%2Ftechnote-space%2Fcsrf-detector?id=blog-card-3uvhi7gtvn&#x26;referrer=https%3A%2F%2Ftechnote.space%2Fposts%2Fwpxml-csrf-detector%2F\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" data-id=\"blog-card-3uvhi7gtvn\"></iframe></div>\n\n<h2 id=\"機能\">機能<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#機能\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h2>\n\n<p><span class=\"double-underline\"><strong>SQLの実行</strong> 及び <strong>nonceのチェック</strong> を監視</span>します。<br><strong>nonceのチェック</strong> が行われる前に <strong>create</strong> <strong>insert</strong> <strong>update</strong> <strong>delete</strong> などの <strong>SQLコマンドが実行</strong> されたときに</p>\n\n<ul><li>ログに保存</li><li>メールで通知</li><li>処理を停止</li></ul>\n\n<p>を行います。</p>\n\n<p>プラグインやテーマを本番環境で使用する前にCSRFの脆弱性がないかどうかを簡易チェックするために作成したものであるため、主にローカルでの使用を想定しています。</p>\n\n<h2 id=\"導入手順\">導入手順<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#導入手順\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h2>\n\n<ol><li><a href=\"https://github.com/technote-space/csrf-detector/archive/master.zip\" target=\"_blank\" rel=\"noreferrer noopener\">ZIPをダウンロード</a></li><li>『プラグインのアップロード』からインストール<br><a href=\"https://technote.space/uploads/2019/01/04102143.png\"><img class=\"wp-image-1428\" style=\"width: 150px;\" src=\"https://technote.space/uploads/2019/01/04102143.png\" alt=\"\"></a></li><li>プラグインを有効化</li></ol>\n\n<h2 id=\"設定\"><a href=\"https://github.com/technote-space/csrf-detector#%E8%A8%AD%E5%AE%9A\"></a>設定<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#設定\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h2>\n\n<h3 id=\"検知したときに処理を終了させるかどうか\"><a href=\"https://github.com/technote-space/csrf-detector#%E6%A4%9C%E7%9F%A5%E3%81%97%E3%81%9F%E3%81%A8%E3%81%8D%E3%81%AB%E5%87%A6%E7%90%86%E3%82%92%E7%B5%82%E4%BA%86%E3%81%95%E3%81%9B%E3%82%8B%E3%81%8B%E3%81%A9%E3%81%86%E3%81%8B\"></a>検知したときに処理を終了させるかどうか<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#検知したときに処理を終了させるかどうか\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h3>\n\n<p>CSRFと思われる動作を検知したときに処理を終了させてSQLが実行されないようにするかどうかを設定します。<br><strong>[default = true]</strong></p>\n\n<h3 id=\"検知したときのメール送信先\"><a href=\"https://github.com/technote-space/csrf-detector#%E6%A4%9C%E7%9F%A5%E3%81%97%E3%81%9F%E3%81%A8%E3%81%8D%E3%81%AE%E3%83%A1%E3%83%BC%E3%83%AB%E9%80%81%E4%BF%A1%E5%85%88\"></a>検知したときのメール送信先<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#検知したときのメール送信先\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h3>\n\n<p>CSRFと思われる動作を検知したときに送信するメールの送信先を設定します。<br>カンマ区切りで複数指定可能です。<br><strong>[default = '']</strong></p>\n\n<h3 id=\"監視するsqlコマンド\"><a href=\"https://github.com/technote-space/csrf-detector#%E7%9B%A3%E8%A6%96%E3%81%99%E3%82%8Bsql%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89\"></a>監視するSQLコマンド<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#監視するsqlコマンド\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h3>\n\n<p>実行の監視を行うSQLコマンドをカンマ区切りで設定します。<br><strong>[default = 'create,alter,truncate,drop,insert,delete,update,replace']</strong></p>\n\n<h3 id=\"除外するオプションのパターン\"><a href=\"https://github.com/technote-space/csrf-detector#%E9%99%A4%E5%A4%96%E3%81%99%E3%82%8B%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3\"></a>除外するオプションのパターン<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#除外するオプションのパターン\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h3>\n\n<p>監視から除外するオプションの検索パターンを正規表現で設定します。<br>キャッシュ等のために使用されるオプション値の保存などを除外するために使用します。<br><strong>[default = '/^(_transient_|_site_transient_)/']</strong></p>\n\n<h3 id=\"getメソッドを除外するかどうか\"><a href=\"https://github.com/technote-space/csrf-detector#post%E3%81%AE%E3%81%BF%E3%82%92%E5%AF%BE%E8%B1%A1%E3%81%A8%E3%81%99%E3%82%8B%E3%81%8B%E3%81%A9%E3%81%86%E3%81%8B\"></a>GETメソッドを除外するかどうか<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#getメソッドを除外するかどうか\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h3>\n\n<p>通常、値の追加・更新・削除等に使用しない送信メソッド <strong>GET</strong> <strong>HEAD</strong> <strong>TRACE</strong> <strong>OPTIONS</strong> を対象から除外するかどうかを設定します。<br><strong>[default = false]</strong></p>\n\n<h3 id=\"管理画面以外を除外するかどうか\"><a href=\"https://github.com/technote-space/csrf-detector#%E7%AE%A1%E7%90%86%E7%94%BB%E9%9D%A2%E3%81%AE%E3%81%BF%E3%82%92%E5%AF%BE%E8%B1%A1%E3%81%A8%E3%81%99%E3%82%8B%E3%81%8B%E3%81%A9%E3%81%86%E3%81%8B\"></a>管理画面以外を除外するかどうか<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#管理画面以外を除外するかどうか\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h3>\n\n<p>WordPressへのログイン権限が必要な管理画面のみを対象とするかどうかを設定します。<br>CSRFは権限を持った人に意図しない操作をさせてその人の権限を悪用する攻撃であるため、権限が不要な操作はCSRFではありません。<br>フロント側でも何か権限を使用して更新するようなことがある場合は監視したほうがよいですが<span class=\"double-underline\">通常は不要です。</span><br>またプラグインやテーマが追加したページのみが監視対象である管理画面と異なり管理画面以外は対象が広いためCSRFではないにもかかわらず検知してしまう可能性が高いです。<br><strong>[default = true]</strong></p>\n\n<h3 id=\"同じホストからの送信を除外するかどうか\">同じホストからの送信を除外するかどうか<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#同じホストからの送信を除外するかどうか\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h3>\n\n<p>通常CSRFは攻撃者の用意した外部の罠ページから行われます。<br>ただしGETメソッドで攻撃可能な状態である場合、コメント欄等からでも攻撃可能な場合があるためデフォルトでは除外しない設定になっています。<br>またリファラを送信しないブラウザを使用している場合は常に異なるホストと判定されます。<br><strong>[default = false]</strong></p>\n\n<h3 id=\"管理画面からの送信を除外するかどうか\"><a href=\"https://github.com/technote-space/csrf-detector#%E7%AE%A1%E7%90%86%E7%94%BB%E9%9D%A2%E3%81%8B%E3%82%89%E3%81%AE%E9%80%81%E4%BF%A1%E3%82%92%E9%99%A4%E5%A4%96%E3%81%99%E3%82%8B%E3%81%8B%E3%81%A9%E3%81%86%E3%81%8B\"></a>管理画面からの送信を除外するかどうか<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#管理画面からの送信を除外するかどうか\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h3>\n\n<p>CSRFは攻撃者が攻撃用のコードを埋め込むことが可能な場所から行われます。<br>したがって通常は管理画面経由で行われることはありません。<br>プラグインやテーマの開発者はこの設定を <strong>false </strong>にすることで脆弱性の確認を手軽に行うことができます。<br><span class=\"double-underline\">新しくプラグインやテーマを使用する際に脆弱性がないか確認する場合</span>にも <strong>false </strong>に設定します。<br><strong>[default = true]</strong></p>\n\n<h2 id=\"アクションの実行\"><a href=\"https://github.com/technote-space/csrf-detector#%E3%82%A2%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E5%AE%9F%E8%A1%8C\"></a>アクションの実行<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#アクションの実行\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h2>\n\n<p>CSRFを検知した際に <strong>csrf_detector/csrf_detected</strong> アクションが発行されます。<br>以下のようなプログラムをテーマの <strong>functions.php</strong> などに追加すると検知時の動作を追加できます。</p>\n\n<pre class=\"language-php\" style=\"background: #2e3440\"><code class=\"language-php\"><span style=\"color: #D8DEE9FF\">add_action( 'csrf_detector/csrf_detected', function ( $query, $backtrace, $target ) {</span>\n<span style=\"color: #D8DEE9FF\">\tvar_dump( $query ); // 実行されたSQL</span>\n<span style=\"color: #D8DEE9FF\">\tvar_dump( $backtrace ); // プログラムの実行履歴</span>\n<span style=\"color: #D8DEE9FF\">\tvar_dump( $target ); // 検出した対象のプラグインまたはテーマ</span>\n<span style=\"color: #D8DEE9FF\">\t</span>\n<span style=\"color: #D8DEE9FF\">\t// exit;</span>\n<span style=\"color: #D8DEE9FF\">}, 10, 3 );</span></code></pre>\n\n<h2 id=\"要件\">要件<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#要件\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h2>\n\n<ul><li>PHP 5.6 以上</li><li>WordPress 3.9.3 以上</li></ul>\n\n<h2 id=\"注意事項\"><a href=\"https://github.com/technote-space/csrf-detector#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A0%85\"></a>注意事項<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#注意事項\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h2>\n\n<ul><li><span class=\"double-underline\">このプラグインで検知された場合でもCSRFではない場合があります。</span><ul><li>例：プラグイン内部での更新動作（アクセスするユーザの権限に関係なくサイトへのアクセスを起点に何か更新を行う場合）</li></ul></li><li><span class=\"double-underline\">CSRF全てを検知できるわけではありません。</span><ul><li>init アクションより後が監視対象であるため、プラグインの読み込みと同時に更新するような行儀の悪いプラグインは検出できません</li></ul></li><li>設定によっては検知した場合に処理を停止するため、<span class=\"double-underline\">設定値などが想定していない状態になる可能性</span>があります。したがって<span class=\"double-underline\">自分ですべてを復旧できる自信がある場合</span>にご使用ください。</li><li>開発版のため仕様等が変更される場合があります。</li></ul>\n\n<h2 id=\"要望バグ報告等\">要望・バグ報告等<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#要望バグ報告等\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h2>\n\n<div class=\"blog-card\"><iframe src=\"https://blog-card-ten.vercel.app/card/https%3A%2F%2Fgithub.com%2Ftechnote-space%2Fcsrf-detector%2Fissues?id=blog-card-13ha18qfqp&#x26;referrer=https%3A%2F%2Ftechnote.space%2Fposts%2Fwpxml-csrf-detector%2F\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" data-id=\"blog-card-13ha18qfqp\"></iframe></div>\n\n<h2 id=\"今後の予定等\">今後の予定等<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#今後の予定等\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h2>\n\n<div class=\"blog-card\"><iframe src=\"https://blog-card-ten.vercel.app/card/https%3A%2F%2Fgithub.com%2Ftechnote-space%2Fcsrf-detector%2Fprojects%2F1?id=blog-card-ekjhshdcdc&#x26;referrer=https%3A%2F%2Ftechnote.space%2Fposts%2Fwpxml-csrf-detector%2F\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" data-id=\"blog-card-ekjhshdcdc\"></iframe></div>\n\n<h2 id=\"使用しているフレームワーク\">使用しているフレームワーク<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#使用しているフレームワーク\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h2>\n\n<div class=\"blog-card\"><iframe src=\"https://blog-card-ten.vercel.app/card/https%3A%2F%2Fgithub.com%2Fwp-content-framework%2Fcore?id=blog-card-th0jm9ta40&#x26;referrer=https%3A%2F%2Ftechnote.space%2Fposts%2Fwpxml-csrf-detector%2F\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" data-id=\"blog-card-th0jm9ta40\"></iframe></div>\n\n<h2 id=\"このプラグインで検知した脆弱性履歴随時更新\">このプラグインで検知した脆弱性履歴（随時更新）<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#このプラグインで検知した脆弱性履歴随時更新\"><svg class=\"icon icon-link\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewBox=\"0 0 24 24\" aria-labelledby=\"paperclipIconTitle\" stroke=\"#2329EE\" stroke-width=\"1\" stroke-linecap=\"square\" stroke-linejoin=\"miter\" fill=\"none\" color=\"#131996\"><path d=\"M7.93517339,13.7795989 L15.1617306,6.55304173 C16.03921,5.67631227 17.4656766,5.67631227 18.343156,6.55304173 C19.2206355,7.43052116 19.2206355,8.85773771 18.343156,9.73521714 L8.40091248,19.5477137 C6.93619681,21.0124294 4.56325242,21.0124294 3.09853675,19.5477137 C1.63382108,18.083748 1.63382108,15.7093037 3.09853675,14.245338 L12.9335328,4.53783896 C14.9839848,2.48738701 18.3094068,2.48738701 20.3568588,4.53783896 C22.4088107,6.58904088 22.4088107,9.91146301 20.3583588,11.961915 L13.2390491,19.0819746\"></path></svg></a></h2>\n\n<ul><li>テーマ （<a href=\"/wordpress/theme-security-report\" target=\"_blank\" rel=\"noreferrer noopener\">関連記事</a>）</li><li>9000+アクティブのプラグイン（<a href=\"/wordpress/check-copy-contents-csrf\" target=\"_blank\" rel=\"noreferrer noopener\">関連記事</a>）</li><li>200000+アクティブの短縮URL系プラグイン（<a href=\"/wordpress/pretty-links-vulnerability\" target=\"_blank\" rel=\"noreferrer noopener\">関連記事</a>）</li></ul>\n<!-- /wp:list --></body></html>","excerpt":"GITHUB 機能  SQLの実行 及び nonceのチェック を監視します。 nonceのチェック が行われる前に create insert update delete などの SQLコマンドが実行 されたときに   * ログに保存  ...","postType":"post","tags":[{"slug":"csrf","name":"CSRF"},{"slug":"%e3%82%bb%e3%82%ad%e3%83%a5%e3%83%aa%e3%83%86%e3%82%a3","name":"セキュリティ"},{"slug":"%e3%83%97%e3%83%a9%e3%82%b0%e3%82%a4%e3%83%b3","name":"プラグイン"}],"thumbnail":"https://technote.space/uploads/2019/01/csrf-detector.png","dominantColor":"rgba(175,242,199,1)","createdAt":"2019-01-28T15:48:55.000Z","updatedAt":null},"prev":{"id":"wpxml-gutenberg-richtext-bug","title":"Gutenbergのリッチテキストの既知の問題","excerpt":"経緯 こちらの記事の現象が開発中のプラグインでも発生したため原因を調査しました。   現象   1. クラスとタグ名を指定して registerFormatType でフォーマットタイプを登録  2. ビジュアルエディタのツールボタン等から...","postType":"post","tags":[{"slug":"gutenberg","name":"Gutenberg"},{"slug":"%e3%83%90%e3%82%b0","name":"バグ"},{"slug":"%e3%83%aa%e3%83%83%e3%83%81%e3%83%86%e3%82%ad%e3%82%b9%e3%83%88","name":"リッチテキスト"}],"thumbnail":"https://technote.space/uploads/2018/12/banner-772x250.jpg","createdAt":"2019-02-06T08:18:46.000Z","updatedAt":null},"next":{"id":"wpxml-notes-github-free-private-repository","title":"GitHubが無料でプライベートリポジトリを使用可能に","excerpt":"GitHubを無料で利用しているユーザーもプライベートリポジトリを作成できるようになりました！ すでに公開しているリポジトリでもプライベートに変更することが可能です。   * 1. 設定に移動  * 2. Make privateを押下  ...","postType":"post","tags":[{"slug":"github","name":"GitHub"},{"slug":"private-repository","name":"private repository"},{"slug":"%e3%83%97%e3%83%a9%e3%82%a4%e3%83%99%e3%83%bc%e3%83%88%e3%83%aa%e3%83%9d%e3%82%b8%e3%83%88%e3%83%aa","name":"プライベートリポジトリ"}],"thumbnail":"https://technote.space/uploads/2019/01/GitHub_Logo.png","createdAt":"2019-01-08T01:32:03.000Z","updatedAt":null},"headerPages":[],"footerPages":[{"label":"About","url":"/pages/wpxml-about/"},{"label":"プライバシーポリシー","url":"/pages/wpxml-privacy-policy/"},{"label":"お問い合わせ","url":"/pages/wpxml-contact/"}]},"__N_SSG":true}